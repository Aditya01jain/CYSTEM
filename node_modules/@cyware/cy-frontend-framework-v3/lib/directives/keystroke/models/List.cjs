"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const r=require("../../../utilities/constants.cjs"),n=require("../../../utilities/aria-utils.cjs"),o=(h,t,e="true")=>h?.getAttribute(t,!1)===e,c={childList:!0,subtree:!0,attributes:!0};class b{constructor(t,e={}){this.el=t,this.lists=[],this.initAttributes(),this.initBindListeners(),this.initEvents(),this.options=e,this.observer=new MutationObserver(this.oberservable.bind(this)),this.observer.observe(this.el,c)}initAttributes(){this.isFocusTabChild=o(this.el,"focus-tab-child"),this.skipLevelFocus=o(this.el,"skip-level-focus"),this.activeClass=this.el.getAttribute("activeClass")}initBindListeners(){this.handleKeyDown=this.handleKeyDown.bind(this),this.handleBlurEvent=this.handleBlurEvent.bind(this),this.handleListKeyFocus=this.handleListKeyFocus.bind(this)}handleListKeyFocus(t,e){const s=t.which||t.keyCode;!isTab(t)||r.KEYBOARD_EVENTS.DOWN!==s||e.contains(document.activeElement)||(n.default.preventEvents(t),e?.children?.[0]?.setAttribute("tabindex",0),n.default.attemptFocus(e?.children?.[0]))}oberservable(t){for(const{type:e,attributeName:s}of t)e==="childList"?this.initializeSubNodes():e==="attributes"&&s==="cy-data-list"&&this.initSubNodes()}initEvents(){this.el.addEventListener("keydown",this.handleKeyDown),this.activeClass=this.el.getAttribute("activeClass"),this.initializeSubNodes()}initSubNodes(){let t=[];o(this.el,"cy-data-list")?t=[this.el]:t=Array.from(this.el.querySelectorAll("[cy-data-list]")),this.lists=[...t],this.lists?.length>1&&this.addTabIndex()}addTabIndex(){this.lists.forEach(t=>t.setAttribute("tabindex",0))}initializeSubNodes(){this.initSubNodes()}removeEvents(){this.observer.disconnect(),this.el.removeEventListener("keydown",this.handleKeyDown),this.isFocusTabChild}handleBlurEvent(t){t?.target.classList.remove(this.activeClass)}getTargetElement(t,e){if(e)return e;let s=t?.target,i=s?.parentElement;for(;i!==this.el&&!i?.getAttribute("cy-data-list");)s=i,i=s?.parentElement;return s}updateNodeClass(t,e){e?.removeEventListener("blur",this.handleBlurEvent),t.addEventListener("blur",this.handleBlurEvent)}isNodeFocus(t,e){if(o(t,"disabled"))return!1;const i=n.default.isFocusable(t);if(!this.skipLevelFocus){const l=e?.target;return t?.setAttribute("tabindex",0),this.activeClass?.length&&this.updateNodeClass(t,l),n.default.attemptFocus(t)}return i?(n.default.attemptFocus(t),i):n.default.focusFirstDescendant(t)}findNextFocusable(t,e,s){let i=this.getTargetElement(t,s)[`${e}ElementSibling`];if(i){let l=this.isNodeFocus(i,t,e);for(;!l&&i[`${e}ElementSibling`];)i=i[`${e}ElementSibling`],l=this.isNodeFocus(i,t,e);l&&document?.activeElement&&this.activeClass?.length&&document?.activeElement.classList.add(this.activeClass)}}handleEnter(){document.activeElement.click()}focusPrevElement(t,e){this.findNextFocusable(t,"previous",e)}focusNextElement(t,e){this.findNextFocusable(t,"next",e)}initFocus(t){if(!n.default.isFocusable(t))return n.default.focusFirstDescendant(t);t?.focus()}handleKeyDown(t){const e=()=>{let a=t.target?.parentElement,d;for(;a&&a!==this.el;)d=a,a=a?.parentElement;return d},s=this.el.contains(t?.target),i=this.lists.some(a=>a.contains(t.target)),l=t.which||t.keyCode;let u;i&&(u=e()),r.KEYBOARD_EVENTS.UP===l&&i?this.focusPrevElement(t):r.KEYBOARD_EVENTS.DOWN===l&&i?this.focusNextElement(t):r.KEYBOARD_EVENTS.LEFT===l&&s?this.focusPrevElement(t,u):r.KEYBOARD_EVENTS.RIGHT===l&&s?this.focusNextElement(t,u):r.KEYBOARD_EVENTS.ENTER.includes(l)&&this.handleEnter()}}exports.default=b;
//# sourceMappingURL=List.cjs.map
