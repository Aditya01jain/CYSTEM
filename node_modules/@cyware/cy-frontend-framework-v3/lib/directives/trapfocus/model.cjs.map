{"version":3,"file":"model.cjs","sources":["../../../src/directives/trapfocus/model.js"],"sourcesContent":["import Utils, { TAB_SELECTOR } from \"../../utilities/aria-utils\";\nimport TrackElement from \"./trackElement\";\nimport { uuId } from \"../../utilities/shared\";\nimport {\n  KEY_MAP,\n  isTab,\n  isShiftTab,\n  isCtrlAltLeft,\n  isCtrlAltRight\n} from \"../../utilities/constants\";\n\nimport { debounce } from \"radash\";\nconst SKIP_ROLE_ATTRS = [\"select\", \"dropdown\", \"combobox\"];\n\nconst isEscKey = ({ key, keyCode }) => {\n  return [\"Escape\", \"Esc\"].includes(key) || keyCode === 27;\n};\n\nconst TIMEOUT_INTERVAL = 100;\nconst DEBOUNCE_INTERVAL = 100;\nconst CLOSE_INTERVAL = 0;\nconst MAX_DEPTH = 5;\nconst OBSERVER_MODEL = { childList: true, subtree: true, attributes: false };\nconst trackElements = new TrackElement();\n\nclass Dialog {\n  constructor(el, focusAfterClosed, options) {\n    this.el = el;\n    this.elId = uuId();\n    this.initBindListeners();\n    trackElements.add({ id: this.elId, self: this });\n    this.options = options;\n    this.initNode(focusAfterClosed);\n    this.initObserver();\n    this.initListeners();\n  }\n\n  initOptions(options = {}) {\n    this.dataRole = this.el.getAttribute(\"data-role\");\n    this.options = options;\n    this.skipElements = this.options?.skipElements || [];\n  }\n\n  initBindListeners() {\n    this.tabEvent = this.tabEvent.bind(this);\n    this.handleKeydown = this.handleKeydown.bind(this);\n    this.handleShiftTab = this.handleShiftTab.bind(this);\n    this.handleTab = this.handleTab.bind(this);\n    this.focusEvent = this.focusEvent.bind(this);\n  }\n  initNode(element) {\n    if (!this.el)\n      throw new Error(\n        \"Dialog() requires a DOM element with ARIA role of dialog.\"\n      );\n    if (element instanceof HTMLElement) this.focusAfterClosed = element;\n    else this.focusAfterClosed = Utils.findNode(element);\n    this.lastFocus = document.activeElement;\n    this.isInitFocused = false;\n    let multiplier = 1;\n    if (trackElements.getLength() > 1) multiplier = trackElements.getLength();\n    this.focusFirstNode(this.options?.timer || TIMEOUT_INTERVAL * multiplier);\n  }\n  initListeners(type = \"add\") {\n    let eventType = `${type}EventListener`;\n    document[eventType](\"keydown\", this.tabEvent, {\n      capture: true,\n      passive: false\n    });\n    if (!this.el.getAttribute(\"data-skip-focusin\"))\n      document[eventType](\"focusin\", this.focusEvent, true);\n\n    if (Object.keys(this.options?.keyEvents || {})?.length)\n      this.el[eventType](\"keydown\", this.handleKeydown);\n  }\n  removeLastFocus() {\n    if (this.focusLast)\n      this.focusLast?.removeEventListener(\"keydown\", this.handleTab);\n  }\n  removeFirstFocus() {\n    this.focusFirst?.removeEventListener(\"keydown\", this.handleShiftTab);\n  }\n  removeListeners() {\n    this.removeFirstFocus();\n    this.removeLastFocus();\n    this.initListeners(\"remove\");\n  }\n\n  initObserverAttributes() {\n    let { observer } = this.options || {};\n    let newModel = { ...OBSERVER_MODEL };\n    if (!observer) return newModel;\n    Object.entries(observer || {})?.forEach(([key, value]) => {\n      if (newModel?.hasOwnProperty(key)) newModel[key] = value;\n    });\n    return newModel;\n  }\n  initObserver() {\n    this.observer = new MutationObserver(this.observable.bind(this));\n    this.observer?.observe(this.el, this.initObserverAttributes());\n  }\n  initDebounce() {\n    if (this.debouncer) this.debouncer.cancel();\n    else {\n      const delay = this.options?.debounceTimer || DEBOUNCE_INTERVAL;\n      this.debouncer = debounce({ delay }, () => {\n        let { first: newFirst, last: newLast } = Utils.findEndNodes(this.el);\n        this.initSkipOptions();\n        if (this.focusLast !== newLast) {\n          this.removeLastFocus();\n          this.focusLast = newLast;\n          this.addLastFocusListener();\n        }\n        if (newFirst && this.focusFirst !== newFirst) {\n          this.removeFirstFocus();\n          this.focusFirst = newFirst;\n          this.addFirstFocusListener();\n        }\n      });\n    }\n    this.debouncer();\n  }\n\n  initSkipOptions() {\n    this.skipElements = this.options?.skipElements || [];\n    if (this.options?.modalBodyElement)\n      this.skipElements.push(\n        ...Array.from(document.querySelectorAll(`[data-popup-node=\"true\"]`))\n      );\n  }\n\n  handleTab(event) {\n    if (event?.target !== this.focusLast) return;\n    if (isTab(event) || isCtrlAltRight(event)) {\n      Utils.preventEvents(event);\n      this.initFocusFirst();\n    }\n  }\n  removeDebounce() {\n    this.debouncer?.cancel();\n    this.debouncer = null;\n  }\n  observable(mutationList) {\n    let { targetFunc } = this.options?.observer || {};\n    let flag = false;\n    if (\n      mutationList.some((mutation) => {\n        if (targetFunc) flag = targetFunc(mutation);\n        return (\n          mutation.addedNodes?.length || mutation?.removedNodes?.length || flag\n        );\n      })\n    ) {\n      this.initDebounce();\n    }\n  }\n  addLastFocusListener(nodeElement = this.focusLast) {\n    if (nodeElement) nodeElement?.addEventListener(\"keydown\", this.handleTab);\n  }\n  addFirstFocusListener(nodeElement = this.focusFirst) {\n    nodeElement?.addEventListener(\"keydown\", this.handleShiftTab);\n  }\n  handleShiftTab(event) {\n    if (event?.target !== this.focusFirst) return;\n    if (\n      isShiftTab(event) ||\n      isCtrlAltLeft(event) ||\n      (!this.focusLast && (isTab(event) || isCtrlAltRight(event)))\n    ) {\n      Utils.preventEvents(event);\n      Utils.focusLastDescendant(this.el);\n    }\n  }\n  removeObserver() {\n    this.observer?.disconnect();\n    this.observer = null;\n  }\n  close() {\n    trackElements.remove(this.elId);\n    this.removeListeners();\n    this.removeDebounce();\n    this.removeObserver();\n    this.elId = null;\n    this.lastFocus = null;\n    this.focusLast = null;\n    this.focusFirst = null;\n    if (this.options?.skipAfterClosed) return;\n    if (this.focusAfterClosed) this.handleClose();\n  }\n  handleClose() {\n    let focusAfterClosed = this.focusAfterClosed;\n    const isElementVisible = Utils.isElementVisible(focusAfterClosed);\n    if (!isElementVisible && this.trackElements?.length > 0) return;\n    setTimeout(() => {\n      if (!isElementVisible)\n        focusAfterClosed = this.findClosestTabbable(focusAfterClosed);\n      if (focusAfterClosed !== document.activeElement)\n        Utils.attemptFocus(focusAfterClosed);\n    }, this.options?.closeTimer || CLOSE_INTERVAL);\n  }\n\n  findClosestTabbable(node) {\n    const maxDepth = this.options?.maxTraversal || MAX_DEPTH;\n    let depth = 0;\n    let closestTabbled = node.parentNode?.closest(`${TAB_SELECTOR}`);\n    if (!closestTabbled) {\n      const popperElement = node.closest(\"[data-popper]\");\n      const refAttribute = popperElement?.getAttribute(\"data-popper\");\n      const nodeElement = Utils.findNode(\n        `[id=\"${refAttribute}\"]`,\n        document.body\n      );\n      if (Utils.isElementVisible(nodeElement)) return nodeElement;\n    }\n\n    while (!Utils.isElementVisible(closestTabbled) && closestTabbled) {\n      if (depth >= maxDepth) break;\n      closestTabbled = closestTabbled.closest(TAB_SELECTOR);\n      depth++;\n    }\n    return closestTabbled || document.body;\n  }\n  initNodes() {\n    let nodes = Utils.findEndNodes(this.el);\n    this.focusLast = nodes?.last;\n    this.focusFirst = nodes?.first;\n  }\n  focusFirstNode(timer) {\n    setTimeout(() => {\n      this.initNodes();\n      this.addFirstFocusListener();\n      this.addLastFocusListener();\n      if (!this.options?.skipInitFocus)\n        this.initFocusFirst(this.getInitialFocus());\n    }, timer);\n  }\n  initFocusFirst(element = this.focusFirst) {\n    let isFocused = false;\n    if (element) isFocused = Utils.attemptFocus(element);\n    if (!isFocused) Utils.focusFirstDescendant(this.el);\n  }\n\n  getInitialFocus() {\n    let node = this.focusFirst;\n    if (!this.isInitFocused) {\n      const { focusFirst } = this.options;\n      if (focusFirst?.length) node = Utils.findNode(focusFirst, this.el);\n      if (!(node instanceof HTMLElement)) node = this.focusFirst;\n    }\n    return node;\n  }\n  handleInitFocus(event) {\n    if (isTab(event) || isCtrlAltRight(event)) {\n      event?.stopPropagation();\n      this.initFocusFirst(this.getInitialFocus());\n    } else if (isShiftTab(event) || isCtrlAltLeft(event)) {\n      event?.stopPropagation();\n      Utils.focusLastDescendant(this.el);\n    }\n  }\n  isTargetContained(targetNode) {\n    const dataNode = window.getSelection();\n    if (\n      dataNode?.toString()?.length &&\n      !SKIP_ROLE_ATTRS.includes(this.dataRole)\n    ) {\n      targetNode = dataNode?.focusNode?.parentNode;\n    }\n    return (\n      (this.skipElements?.some((node) => node.contains(targetNode)) ||\n        this.el.contains(targetNode)) &&\n      ![document, document.body].includes(targetNode)\n    );\n  }\n\n  focusEvent(event) {\n    if (!trackElements?.isTopNode(this.elId)) return;\n    const { target } = event;\n    if (this.isTargetContained(target)) {\n      if (this.el.contains(target)) {\n        this.lastFocus = target;\n      }\n    } else {\n      Utils.preventEvents(event);\n      if (this.lastFocus !== target) Utils.attemptFocus(this.focusFirst);\n    }\n  }\n  tabEvent(event) {\n    if (!trackElements?.isTopNode(this.elId)) return;\n    const { target } = event;\n    if (\n      !this.el.contains(target) ||\n      [document, document.body].includes(target)\n    ) {\n      if (isEscKey(event)) {\n        Utils.preventEvents(event);\n        this.handleKeydown(event);\n        return;\n      }\n      this.handleInitFocus(event);\n    }\n  }\n  handleKeydown(event) {\n    const keyCode = event?.keyCode || event?.which;\n    const keyName = KEY_MAP?.[event.key] || keyCode;\n    this.options?.keyEvents?.[keyName]?.(event);\n  }\n}\nexport default Dialog;\n"],"names":["SKIP_ROLE_ATTRS","isEscKey","key","keyCode","TIMEOUT_INTERVAL","DEBOUNCE_INTERVAL","CLOSE_INTERVAL","MAX_DEPTH","OBSERVER_MODEL","trackElements","TrackElement","Dialog","el","focusAfterClosed","options","uuId","element","Utils","multiplier","type","eventType","observer","newModel","value","delay","debounce","newFirst","newLast","event","isTab","isCtrlAltRight","mutationList","targetFunc","flag","mutation","nodeElement","isShiftTab","isCtrlAltLeft","isElementVisible","node","maxDepth","depth","closestTabbled","TAB_SELECTOR","refAttribute","nodes","timer","isFocused","focusFirst","targetNode","dataNode","target","keyName","KEY_MAP"],"mappings":"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"}