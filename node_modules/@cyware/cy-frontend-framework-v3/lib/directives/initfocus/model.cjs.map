{"version":3,"file":"model.cjs","sources":["../../../src/directives/initfocus/model.js"],"sourcesContent":["import Utils from \"../../utilities/aria-utils\";\nimport { KEYBOARD_EVENTS } from \"../../utilities/constants\";\nimport { isNull } from \"../../utilities/shared\";\n\nclass InitFocus {\n  constructor({ el }) {\n    this.el = el;\n    this.initBindListeners();\n    this.targetBody = this.el?.getAttribute(\"cy-body-target\") === \"true\";\n    this.initFocus = this.el?.getAttribute(\"cy-focus-first\") || null;\n  }\n  initBindListeners() {\n    this.initNodeFocus = this.initNodeFocus.bind(this);\n  }\n  init(value = {}) {\n    this.resetNode(value);\n    const isNew = this.initFocusFirstNode(value);\n    if (!isNull(this.focusFirst) && isNew) {\n      const node = Utils.findNode(this.focusFirst, this.el);\n      if (isNull(node)) this.focusFirst = null;\n      this.initListener(node);\n    }\n  }\n\n  initFocusFirstNode(value) {\n    let focusFirst = this.value?.focusFirst || null;\n    if (isNull(this.focusFirst) || !this.focusFirst) {\n      this.focusFirst = this.initFocus || focusFirst;\n      return true;\n    }\n    let flag = false;\n    if (focusFirst?.length && this.focusFirst !== focusFirst) {\n      this.focusFirst = focusFirst;\n      flag = true;\n    }\n    return flag;\n  }\n\n  initListener(node) {\n    if (typeof node === \"object\" && !isNull(node)) this.addListener(node);\n  }\n\n  getAttributeNode() {\n    let focusFirst = this.value?.focusFirst || null;\n    const attribute = this.el?.getAttribute(\"cy-focus-first\") || null;\n    return { focusFirst, attribute };\n  }\n\n  resetNode(value = {}) {\n    const { reInit = false } = value;\n    if (reInit) {\n      this.reset();\n      if (this.targetBody) document?.body?.focus();\n    }\n  }\n  initNodeFocus(event, node) {\n    const targetNode = event?.target;\n    const isBodyElement = this.isBodyElement(targetNode);\n    if (isBodyElement && this.isFirstFocused) {\n      this.reset();\n    }\n    if (this.isFirstFocused) {\n      return true;\n    }\n    if (\n      event?.which === KEYBOARD_EVENTS.TAB &&\n      (this.isInside(targetNode) || isBodyElement)\n    ) {\n      Utils.preventEvents(event);\n      let isFocused = Utils.attemptFocus(node);\n      if (!isFocused) Utils.focusFirstDescendant(node);\n      this.isFirstFocused = true;\n      return false;\n    }\n    return true;\n  }\n  isInside(targetNode) {\n    return this.el?.contains(targetNode) || this.el === targetNode;\n  }\n  isBodyElement(targetElement) {\n    if (!this.targetBody || !targetElement) return false;\n    return targetElement === document?.body && document?.body.contains(this.el);\n  }\n  addListener(nodeElement) {\n    document?.addEventListener(\"keydown\", (event) =>\n      this.initNodeFocus(event, nodeElement)\n    );\n  }\n\n  removeListener() {\n    if (this.isFirstFocused || !document.body.contains(this.el)) {\n      this.reset();\n      document?.removeEventListener(\"keydown\", (event) =>\n        this.initNodeFocus(event)\n      );\n    }\n  }\n  reset() {\n    this.isFirstFocused = false;\n    this.focusFirst = null;\n  }\n}\n\nexport default InitFocus;\n"],"names":["InitFocus","el","value","isNew","isNull","node","Utils","focusFirst","flag","attribute","reInit","event","targetNode","isBodyElement","KEYBOARD_EVENTS","targetElement","nodeElement"],"mappings":"iPAIA,MAAMA,CAAU,CACd,YAAY,CAAE,GAAAC,GAAM,CAClB,KAAK,GAAKA,EACV,KAAK,kBAAiB,EACtB,KAAK,WAAa,KAAK,IAAI,aAAa,gBAAgB,IAAM,OAC9D,KAAK,UAAY,KAAK,IAAI,aAAa,gBAAgB,GAAK,IAC7D,CACD,mBAAoB,CAClB,KAAK,cAAgB,KAAK,cAAc,KAAK,IAAI,CAClD,CACD,KAAKC,EAAQ,GAAI,CACf,KAAK,UAAUA,CAAK,EACpB,MAAMC,EAAQ,KAAK,mBAAmBD,CAAK,EAC3C,GAAI,CAACE,EAAAA,OAAO,KAAK,UAAU,GAAKD,EAAO,CACrC,MAAME,EAAOC,EAAAA,QAAM,SAAS,KAAK,WAAY,KAAK,EAAE,EAChDF,EAAM,OAACC,CAAI,IAAG,KAAK,WAAa,MACpC,KAAK,aAAaA,CAAI,CACvB,CACF,CAED,mBAAmBH,EAAO,CACxB,IAAIK,EAAa,KAAK,OAAO,YAAc,KAC3C,GAAIH,EAAAA,OAAO,KAAK,UAAU,GAAK,CAAC,KAAK,WACnC,YAAK,WAAa,KAAK,WAAaG,EAC7B,GAET,IAAIC,EAAO,GACX,OAAID,GAAY,QAAU,KAAK,aAAeA,IAC5C,KAAK,WAAaA,EAClBC,EAAO,IAEFA,CACR,CAED,aAAaH,EAAM,CACb,OAAOA,GAAS,UAAY,CAACD,EAAM,OAACC,CAAI,GAAG,KAAK,YAAYA,CAAI,CACrE,CAED,kBAAmB,CACjB,IAAIE,EAAa,KAAK,OAAO,YAAc,KAC3C,MAAME,EAAY,KAAK,IAAI,aAAa,gBAAgB,GAAK,KAC7D,MAAO,CAAE,WAAAF,EAAY,UAAAE,EACtB,CAED,UAAUP,EAAQ,GAAI,CACpB,KAAM,CAAE,OAAAQ,EAAS,EAAO,EAAGR,EACvBQ,IACF,KAAK,MAAK,EACN,KAAK,YAAY,UAAU,MAAM,MAAK,EAE7C,CACD,cAAcC,EAAON,EAAM,CACzB,MAAMO,EAAaD,GAAO,OACpBE,EAAgB,KAAK,cAAcD,CAAU,EAInD,OAHIC,GAAiB,KAAK,gBACxB,KAAK,MAAK,EAER,KAAK,eACA,GAGPF,GAAO,QAAUG,EAAAA,gBAAgB,MAChC,KAAK,SAASF,CAAU,GAAKC,IAE9BP,UAAM,cAAcK,CAAK,EACTL,EAAAA,QAAM,aAAaD,CAAI,GACvBC,EAAAA,QAAM,qBAAqBD,CAAI,EAC/C,KAAK,eAAiB,GACf,IAEF,EACR,CACD,SAASO,EAAY,CACnB,OAAO,KAAK,IAAI,SAASA,CAAU,GAAK,KAAK,KAAOA,CACrD,CACD,cAAcG,EAAe,CAC3B,MAAI,CAAC,KAAK,YAAc,CAACA,EAAsB,GACxCA,IAAkB,UAAU,MAAQ,UAAU,KAAK,SAAS,KAAK,EAAE,CAC3E,CACD,YAAYC,EAAa,CACvB,UAAU,iBAAiB,UAAYL,GACrC,KAAK,cAAcA,EAAOK,CAAW,CAC3C,CACG,CAED,gBAAiB,EACX,KAAK,gBAAkB,CAAC,SAAS,KAAK,SAAS,KAAK,EAAE,KACxD,KAAK,MAAK,EACV,UAAU,oBAAoB,UAAYL,GACxC,KAAK,cAAcA,CAAK,CAChC,EAEG,CACD,OAAQ,CACN,KAAK,eAAiB,GACtB,KAAK,WAAa,IACnB,CACH"}