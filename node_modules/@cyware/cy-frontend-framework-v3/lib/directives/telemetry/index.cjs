"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const a=require("mixpanel-browser"),D=require("./models/OfflineQueue.cjs"),I=require("./models/AsyncHandler.cjs");let h=!1,p={};const $=new D.default,_=new I.default;function K(y,k={}){const{user:c,client:o,appKey:l,limit:A=4,isEnabled:E,eventPrefix:P,pattern:T="section:module",trackOn:g}=k;Q(y,x,v),j();let u={};function j(){l&&E&&(a.init(l,{cross_subdomain_cookie:!1}),S(),$.trackAll(f,p),h=!0),p={tenant:o,user:c}}function S(){a.identify(c),a.people.set({$name:c}),a.register({tenant:o,user:c})}let m=T.split(":").map(e=>"cy"+e.charAt(0).toUpperCase()+e.slice(1));const q=g||m[0];function b(e){if(e.$handled)return;const i=e?.composedPath?.()||e.path;let r=!1,t=null,n=i.reduce((s,d,L)=>{const M=m.some(C=>Object.keys(d?.dataset||{}).includes(C));return t=t||d?.dataset?.cyProperties,r=r||!!d?.dataset?.[q],L<A&&M?{...s,...d?.dataset||{}}:s},{});n&&r&&(e.$handled=!0,t?f({...u,...n},JSON.parse(t)):f({...u,...n}))}function w(e){v(e),e.addEventListener("click",b,!0)}function x(e,i){u=i||{},Object.entries(u).forEach(([r,t])=>e.setAttribute(`data-cy-${r}`,t)),w(e)}function v(e){e.removeEventListener("click",b)}function O(e,{status:i,...r}){const t=_.pop(e);if(!t)return;const n=i?"Success":"Error",s={...p,...r,status:n};h?a.track(`${t}:${n}`,s):$.push(`${t}:${n}`,s)}function H(e,i){return new Promise(r=>{typeof i=="function"?i((t,n)=>{t||O(e,{status:t,errors:n}),r({status:t,errors:n})}):(O(e,i),_.delete(e))})}function f(e,i={}){const r=m.map(s=>e[s]).filter(s=>!!s).join(":"),t=`${P}:${r}`,n={...p,...i};e.cyId&&_.push(e.cyId,t),h?a.track(t,n):$.push(t,n)}return{track:f,$validate:H}}function Q(y,k,c){y.directive("cy-tracker",{beforeMount(o,l){k(o,l.value)},unmounted(o){c(o)}})}exports.default=K;
//# sourceMappingURL=index.cjs.map
