{"version":3,"file":"index.cjs","sources":["../../../../src/directives/table/models/index.js"],"sourcesContent":["import { KEYBOARD_EVENTS } from \"../../../utilities/constants\";\nimport {\n  detectOS,\n  detectBrowser,\n  isHTMLElement\n} from \"../../../utilities/shared\";\nimport ariaUtils, {\n  getAttribute,\n  hasWidthHeight\n} from \"../../../utilities/aria-utils\";\nimport { ALLY_TEXT, SELECTORS, DEBOUNCE_INTERVAL } from \"./variables.js\";\nimport { getElementByParent, isNodeVisible } from \"./utils.js\";\nimport { debounce } from \"radash\";\n\nclass TableModel {\n  constructor(el, options) {\n    this.el = el;\n    this.initOptions(options);\n    this.parent = \"scroll\";\n    this.lastFocus = null;\n    this.isFocused = false;\n    this.initBindListeners();\n    this.initObserver();\n    this.initKeyStrokes();\n    this.init();\n  }\n  initOptions(options = {}) {\n    this.options = { stopPropagation: true, ...(options || {}) };\n    if (detectBrowser() === \"safari\") this.options.preventEvents = true;\n  }\n  initKeyStrokes() {\n    this.keyStroke = new Map();\n    this.keyMap = {\n      ct: this.focusColSelector.bind(this)\n    };\n  }\n  init() {\n    this.initEvents();\n  }\n  initTable() {\n    if (!isHTMLElement(this.el)) return;\n    const scrollTableHeaders = this.el.querySelector(\n      \".el-table__header-wrapper\"\n    );\n    const scrollTableBody = this.el.querySelector(\".el-table__body-wrapper\");\n    this.scrollHeaders = this.getHeaders(scrollTableHeaders);\n    this.scrollRows = this.getRows(scrollTableBody);\n    this.initInitalFocus();\n    this.initSelectors();\n  }\n  initInitalFocus() {\n    const node = this.scrollHeaders[0];\n    if (this.scrollHeaders?.length) {\n      this.initScrollElement();\n    }\n    if (this.initialFocus && this.initialFocus !== node)\n      this.initialFocus.removeAttribute(\"tabindex\");\n    else if (node instanceof HTMLElement) {\n      this.initialFocus = node;\n      node?.setAttribute(\"tabindex\", 0);\n    }\n  }\n  initObserver() {\n    this.observer = new MutationObserver(this.observable.bind(this));\n    this.observer.observe(this.el, { childList: true, subtree: true });\n  }\n  initDebounce() {\n    if (this.debouncer) this.debouncer.cancel();\n    else {\n      const delay = this.options?.debounceTimer || DEBOUNCE_INTERVAL;\n      this.debouncer = debounce({ delay }, () => this.initTable());\n    }\n    this.debouncer();\n  }\n  removeDebounce() {\n    this.debouncer?.cancel();\n    this.debouncer = nul;\n  }\n  observable(mutationList) {\n    let { targetFunc } = this.options?.observer || {};\n    let flag = false;\n    if (\n      mutationList.some((mutation) => {\n        if (targetFunc) flag = targetFunc(mutation);\n        return (\n          mutation.addedNodes?.length || mutation?.removedNodes?.length || flag\n        );\n      })\n    ) {\n      this.initDebounce();\n    }\n  }\n\n  addAriaAttrs(event) {\n    if (this.isFocused) return;\n    ariaUtils.preventEvents(event);\n    let ariaDescription = ALLY_TEXT.common;\n    if (detectOS() === \"windows\")\n      ariaDescription = ALLY_TEXT.windows + ariaDescription;\n\n    let ariaLabel;\n\n    const tables = Array.from(\n      this.el.querySelectorAll(\".el-table__header, .el-table__body\")\n    );\n    tables.forEach((table, index) => {\n      ariaLabel = index < 2 ? ALLY_TEXT.scroll : ALLY_TEXT.fixed;\n      table.setAttribute(\"aria-label\", [ariaLabel, ariaDescription].join(\", \"));\n    });\n    this.isFocused = true;\n  }\n\n  initScrollElement() {\n    if (!this.scrollHeaders?.[0]?.hasAttribute(\"tabindex\"))\n      this.scrollHeaders?.[0]?.setAttribute(\"tabindex\", 0);\n  }\n  initBindListeners() {\n    this.handleNodeDownKey = this.handleNodeDownKey.bind(this);\n    this.initTableEvent = this.initTableEvent.bind(this);\n  }\n\n  initTableEvent(event) {\n    const target = event?.target;\n    const isTargetContained = this.el.contains(target) || target === this.el;\n    if (isTargetContained) {\n      ariaUtils.preventEvents(event);\n      event?.stopImmediatePropagation();\n      setTimeout(() => {\n        this.setNodeFocus(this.initialFocus);\n      }, 100);\n      return true;\n    }\n  }\n\n  initSelectors() {\n    this.colSelector = this.el.querySelector(\".cyw-column-selector-btn\");\n    this.bindSelectorListener(this.colSelector);\n  }\n\n  bindSelectorListener(node, type = \"add\") {\n    if (node instanceof HTMLElement)\n      node?.[`${type}EventListener`](\"keydown\", this.handleNodeDownKey);\n  }\n\n  handleNodeDownKey(event) {\n    const key = event?.which || event?.keyCode;\n    if (key === KEYBOARD_EVENTS?.DOWN) {\n      if (!this.scrollRows?.length) return;\n      ariaUtils.preventEvents(event);\n      const firstRowCols = this.scrollRows?.[0]?.children;\n      if (firstRowCols?.length) {\n        const nextElement = firstRowCols[firstRowCols.length - 1];\n        this.setNodeFocus(nextElement);\n      }\n    }\n  }\n\n  initEvents() {\n    this.handleKeyEvent = this.handleKeyEvent.bind(this);\n    this.handleKeyUp = this.handleKeyUp.bind(this);\n    this.addAriaAttrs = this.addAriaAttrs.bind(this);\n\n    this.el.addEventListener(\"keydown\", this.handleKeyEvent);\n    this.el.addEventListener(\"keyup\", this.handleKeyUp);\n    this.el.addEventListener(\"focusin\", this.addAriaAttrs);\n  }\n\n  reset() {\n    this.el.removeEventListener(\"keydown\", this.handleKeyEvent);\n    this.el.removeEventListener(\"keyup\", this.handleKeyUp);\n    this.el.removeEventListener(\"focusin\", this.addAriaAttrs);\n    this.bindSelectorListener(this.colSelector, \"remove\");\n    this.observer?.disconnect();\n    this.isFocused = false;\n    this.removeDebounce();\n  }\n\n  getHeaders(table) {\n    return Array.from(\n      table?.querySelectorAll(\".el-table__header th:not(.is-hidden)\") || []\n    ).filter((header) => isNodeVisible(header));\n  }\n\n  getRows(table) {\n    return Array.from(table?.querySelectorAll(\".cyw-table-row\") || []).map(\n      (row, idx) => {\n        row.setAttribute(\"rowIndex\", idx);\n        return row;\n      }\n    );\n  }\n\n  isHeader(node) {\n    const flag =\n      node.parentElement.classList.contains(\"column-header\") ||\n      node.nodeName === \"TH\";\n    if (flag) return true;\n    const header = getElementByParent(node);\n    return header !== null;\n  }\n\n  getRowIndex(node) {\n    if (!node) return;\n    let parentRow = getElementByParent(node, \"TR\");\n    let idx = parentRow?.getAttribute(\"rowIndex\");\n    return parseInt(idx);\n  }\n\n  getColumnIndex(node, isHeader = false) {\n    if (!node) return;\n    const { classList } = node;\n    const colClass = Array.from(classList || []).find((colClass) =>\n      (colClass || \"\").startsWith(\"cyw-table-column-\")\n    );\n    const classArr = colClass?.split(\"-\");\n    let updatedNode;\n    if (!classArr?.length) {\n      updatedNode = getElementByParent(node, isHeader ? \"TH\" : \"TD\");\n      return this.getColumnIndex(updatedNode);\n    }\n    return parseInt(classArr[classArr.length - 1]);\n  }\n\n  getNextVisibleScrollNode(nodes, startIndex = 0) {\n    let idx = startIndex;\n    if (!nodes?.length) return;\n    let element = nodes?.[idx];\n    while (idx < nodes?.length - 1) {\n      if (isNodeVisible(element, false)) break;\n      element = nodes[++idx];\n    }\n    return element;\n  }\n  getNextTable(node, isHeader) {\n    if (isHeader) return this.scrollHeaders[0];\n    else {\n      const rowIdx = this.getRowIndex(node);\n      return this.getNextVisibleScrollNode(this.scrollRows?.[rowIdx]?.children);\n    }\n  }\n  handleEnter({ target }) {\n    if (this.isHeader(target)) return;\n    const rowIdx = this.getRowIndex(target);\n    let rows = this.scrollRows;\n    rows[rowIdx]?.click();\n  }\n  handleLeftRight(event, type) {\n    const key = event.which || event.keyCode;\n    if (event.target === this.colSelector && key === KEYBOARD_EVENTS.LEFT) {\n      this.colSelector.removeAttribute(\"tabindex\");\n      this.setNodeFocus(\n        this.scrollHeaders[this.scrollHeaders.length - 1],\n        event\n      );\n    }\n    const isHeader = this.isHeader(event.target);\n    const elementNode = getElementByParent(\n      event.target,\n      isHeader ? \"TH\" : \"TD\"\n    );\n    if (!elementNode) return;\n    this.focusLeftRightNode(elementNode, event, { type, isHeader });\n  }\n\n  isColumnSelector(event, nextFocusable) {\n    if (\n      !getAttribute(this.el, \"data-col-selector\") ||\n      ![event?.which, event?.keyCode].includes(KEYBOARD_EVENTS.RIGHT)\n    )\n      return false;\n    const scrollLength = this.scrollHeaders?.length - 1 || 0;\n    let lastChild =\n      scrollLength > 0 ? this.scrollHeaders[scrollLength - 1] : null;\n    return !nextFocusable || (this.lastFocus && this.lastFocus === lastChild);\n  }\n  async focusLeftRightNode(node, event, { type, isHeader }) {\n    let nextFocusable = node[`${type}ElementSibling`];\n    if (this.isColumnSelector(event, nextFocusable) && isHeader) {\n      this.focusColSelector(event);\n      return;\n    }\n    const isHidden = !isNodeVisible(nextFocusable, isHeader);\n    if (isHidden) {\n      nextFocusable = this.getNextTable(nextFocusable, isHeader);\n    }\n\n    if (!isHeader) this.updateColumnNode(nextFocusable);\n    else this.heaserScrollFix(nextFocusable);\n    this.setNodeFocus(nextFocusable, event);\n  }\n\n  heaserScrollFix(nextFocusable) {\n    if (!nextFocusable.classList.contains(\"el-table-fixed-column--left\")) {\n      const lastFixed = this.el.querySelector(\n        \".el-table-fixed-column--left.is-last-column\"\n      );\n      const scrollWrap = this.el.querySelector(\n        \".el-table__body-wrapper .el-scrollbar__wrap\"\n      );\n      const coords = lastFixed?.getBoundingClientRect?.() ?? { right: 0 };\n      const nCoords = nextFocusable?.getBoundingClientRect?.() ?? {\n        left: 0\n      };\n      scrollWrap?.scrollTo?.({\n        behavior: \"smooth\",\n        left: nCoords.left - coords.right\n      });\n    }\n  }\n\n  handleUpDown(event, pivot = -1) {\n    const isHeader = this.isHeader(event.target);\n    let rowIndex = this.getRowIndex(event.target);\n    let colIndex = this.getColumnIndex(event.target, isHeader);\n    let rows = this.scrollRows;\n    rowIndex = rowIndex + pivot;\n    if (isHeader) rowIndex = 0;\n    if (rowIndex < 0) {\n      this.handleHeaderUpDown(event, { colIndex });\n      return true;\n    }\n    if (rowIndex >= rows?.length) {\n      ariaUtils.preventEvents(event);\n      return true;\n    }\n    this.initPreventEvents(event);\n    this.handleRowFocus(rows, { rowIndex, colIndex, isHeader });\n  }\n\n  handleHeaderUpDown(event, { colIndex }) {\n    let headers = this.scrollHeaders || [];\n    let hasHiddenCol =\n      this.scrollHeaders.length < this.scrollRows[0].children.length;\n    colIndex = colIndex + (hasHiddenCol ? -1 : 0);\n    this.setNodeFocus(headers[colIndex], event);\n  }\n\n  handleHeaderUpKey() {\n    const checkboxElm = Array.from(\n      this.el.querySelectorAll(\"[data-all-selection]\")\n    ).find((node) => hasWidthHeight(node));\n    if (document?.activeElement === checkboxElm) return;\n    ariaUtils.focusFirstDescendant(checkboxElm);\n  }\n\n  initPreventEvents(event) {\n    let { preventEvents = false } = this.options || {};\n    if (this.options?.preventDefault || preventEvents) event?.preventDefault();\n    if (this.options?.stopPropagation || preventEvents)\n      event?.stopPropagation();\n  }\n\n  setNodeFocus(node, event) {\n    if (!(node instanceof HTMLElement)) return;\n    this.initPreventEvents(event);\n\n    if (this.lastFocus?.classList?.contains?.(\"el-table-fixed-column--left\"))\n      event?.preventDefault?.();\n\n    node?.setAttribute(\"tabindex\", 0);\n    node?.focus();\n    if (this.lastFocus && this.lastFocus !== node)\n      this.lastFocus?.removeAttribute(\"tabindex\");\n    this.lastFocus = node;\n  }\n  handleRowFocus(rows = [], { rowIndex, colIndex, isHeader = false } = {}) {\n    const expectedChildren = rows?.[rowIndex]?.children?.length;\n    const isRowSpan = !rows.every(\n      (row) => row.children?.length === expectedChildren\n    );\n\n    if (isRowSpan && colIndex > 0 && rowIndex > 0) colIndex = colIndex - 1;\n    const currNode = rows[rowIndex]?.children?.[colIndex];\n    if (!isHeader) this.updateColumnNode(currNode);\n    this.setNodeFocus(currNode);\n  }\n\n  updateColumnNode(node) {\n    if (node?.classList?.contains(SELECTORS.actions.class)) {\n      Object.entries(SELECTORS.actions.attributes).forEach(([key, value]) => {\n        node?.setAttribute(key, value);\n      });\n    }\n  }\n  focusColSelector(event) {\n    ariaUtils.preventEvents(event);\n    this.setNodeFocus(this.colSelector);\n  }\n  handleKeyUp(event) {\n    this.keyStroke.set(event.key, false);\n  }\n  handleKeyEvent(event) {\n    const key = event.which || event.keyCode;\n    this.keyStroke.set(event.key, true);\n\n    const leftRight = [KEYBOARD_EVENTS.LEFT, KEYBOARD_EVENTS.RIGHT];\n    const upDown = [KEYBOARD_EVENTS.UP, KEYBOARD_EVENTS.DOWN];\n\n    if (leftRight.includes(key))\n      this.handleLeftRight(\n        event,\n        key === KEYBOARD_EVENTS.LEFT ? \"previous\" : \"next\"\n      );\n    else if (upDown.includes(key))\n      this.handleUpDown(event, KEYBOARD_EVENTS.UP === key ? -1 : 1);\n    else if (KEYBOARD_EVENTS.ENTER.includes(key)) this.handleEnter(event);\n    else {\n      const entries = Array.from(this.keyStroke.entries());\n      const keyArr = entries\n        .filter((entry) => entry[1])\n        .map((entry) => entry[0]);\n      keyArr.sort();\n      const cmd = keyArr.join(\"\");\n      this.keyMap?.[cmd]?.(event);\n    }\n  }\n}\n\nexport default TableModel;\n"],"names":["TableModel","el","options","detectBrowser","isHTMLElement","scrollTableHeaders","scrollTableBody","node","delay","DEBOUNCE_INTERVAL","debounce","mutationList","targetFunc","flag","mutation","event","ariaUtils","ariaDescription","ALLY_TEXT","detectOS","ariaLabel","table","index","target","type","KEYBOARD_EVENTS","firstRowCols","nextElement","header","isNodeVisible","row","idx","getElementByParent","isHeader","classList","classArr","colClass","updatedNode","nodes","startIndex","element","rowIdx","key","elementNode","nextFocusable","getAttribute","scrollLength","lastChild","lastFixed","scrollWrap","coords","nCoords","pivot","rowIndex","colIndex","rows","headers","hasHiddenCol","checkboxElm","hasWidthHeight","preventEvents","expectedChildren","currNode","SELECTORS","value","leftRight","upDown","keyArr","entry","cmd"],"mappings":"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"}