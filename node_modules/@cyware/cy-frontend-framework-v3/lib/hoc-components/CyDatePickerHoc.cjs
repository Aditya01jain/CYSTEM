"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const r=require("vue"),M=require("../directives/trapfocus/model.cjs"),d=require("../utilities/constants.cjs"),$=require("element-plus/es");require("element-plus/es/components/base/style/css");require("element-plus/es/components/date-picker/style/css");const j=[{selector:".el-picker-panel__icon-btn.d-arrow-left",label:"Previous Year"},{selector:".el-picker-panel__icon-btn.arrow-left",label:"Previous Month"},{selector:".el-picker-panel__icon-btn.d-arrow-right",label:"Next Year"},{selector:".el-picker-panel__icon-btn.arrow-right",label:"Next Month"}],U={trapFocus:!0,autoOpen:!1},G={props:{config:{type:Object,default:()=>({trapFocus:!0})},inputId:{type:String,default:""},modelValue:{type:[Date,Array,Number,String],default:""}},emits:["inputFocus","update:modelValue","focus","blur","visibleChange"],setup(c,{attrs:p,emit:s,slots:C,expose:S}){const T=r.inject("popperId",()=>!1),o=r.ref(),t=r.reactive({picker:null,dialogInstance:null,datePickerRef:null,pickerConfig:{...U,...c.config||{}},inputElement:null,valueCopy:c.modelValue});r.onMounted(()=>{t.datePickerRef=o.value?.$el.nextElementSibling,E(),t.pickerConfig.autoOpen&&o.value.handleOpen()});const u=r.computed(()=>p.type?.indexOf("range")>-1),w=r.computed(()=>({focusFirst:".el-icon-d-arrow-left",keyEvents:{esc:x,...c.config.events||{}},observer:{attributes:!0,targetFunc:e=>{if(e.type==="attributes"&&e.attributeName==="tabindex"&&["TD","A"].includes(e.target.tagName))return!0}}}));function x(){o.value.handleClose(),u.value||_(t.valueCopy),setTimeout(()=>s("inputFocus",!1),10)}function N(){o.value.handleOpen()}function P(){o.value.handleClose()}function b(e,n=!1){e&&(u.value?n?e.setAttribute("tabindex",-1):e.setAttribute("tabindex",0):e.setAttribute("role","button"),n?e.setAttribute("aria-disabled",!0):e.removeAttribute("aria-disabled"))}function q(e){e.querySelectorAll("td").forEach(n=>{const a=n.getElementsByClassName("el-date-table-cell__text"),i=!n.classList.contains("available");b(a[0],i)})}function I(e){e.querySelectorAll("td").forEach(n=>{const a=n.getElementsByClassName("cell"),i=n.classList.contains("disabled");b(a[0],i)})}function R(e){e.querySelectorAll("td").forEach(n=>{const a=n.getElementsByClassName("cell"),i=n.classList.contains("disabled")&&!n.classList.contains("available");b(a[0],i)})}async function f(){await r.nextTick(),t.picker?.querySelectorAll("table").forEach(e=>{e.classList.contains("el-date-table")&&q(e),e.classList.contains("el-year-table")&&R(e),e.classList.contains("el-month-table")&&I(e)})}function E(e="add"){const n=`${e==="add"?"set":e}Attribute`;if(u.value){t.datePickerRef?.querySelectorAll(".el-range-input").forEach((i,l)=>{l?(i[n]("tabindex",-1),i[n]("aria-hidden",!0)):e==="add"&&(t.inputElement=i,y(i)),k(i,e,l)});const a=t.datePickerRef?.querySelector(".el-input__icon.el-range__close-icon");a&&h(a)}else{const a=t.datePickerRef?.querySelector(".el-input__inner");e==="add"&&(t.inputElement=a,y(a)),k(a,e)}}function k(e,n="add",a=0){const i=`${n}EventListener`;t.datePickerRef[i]("focus",l=>O(l,a),!0),e[i]("click",o.value.handleOpen),e[i]("keydown",l=>D(l,a)),e[i]("blur",()=>{s("inputFocus",!1)})}function O(e,n=0){const a=new Event("mouseenter",{bubbles:!0});t.inputElement.dispatchEvent(a),n||s("inputFocus",!0),e.stopPropagation(),u.value||setTimeout(()=>{const i=t.datePickerRef?.querySelector(".el-input__icon.clear-icon");i&&h(i)},10)}function h(e){e.setAttribute("tabindex","0"),e.setAttribute("aria-label","Clear"),e.setAttribute("role","button"),e.addEventListener("keydown",n=>{const a=n.keyCode||n.which;d.KEYBOARD_EVENTS.ENTER.includes(a)&&e.click()}),e.addEventListener("blur",g)}function g(){const e=new Event("mouseleave",{bubbles:!0});t.inputElement.dispatchEvent(e)}function D(e,n=0){const a=e.keyCode||e.which;d.KEYBOARD_EVENTS.ENTER.includes(a)&&!n&&(e.stopPropagation(),o.value.handleOpen()),a===d.KEYBOARD_EVENTS.TAB&&!t.picker&&e.stopPropagation(),d.isShiftTab(e)&&g()}function y(e){e.setAttribute("readonly",!0),e.setAttribute("role","combobox"),e.setAttribute("aria-haspopup","dialog"),e.setAttribute("aria-expanded",!1),c.inputId&&e.setAttribute("id",c.inputId)}async function A(e){t.inputElement?.setAttribute("aria-expanded",!0),e&&s("focus",e),t.picker||(await r.nextTick(),B()),L()}function m(e){t.valueCopy=c.modelValue,t.dialogInstance&&(t.dialogInstance?.close(),t.dialogInstance=null),t.inputElement?.setAttribute("aria-expanded",!1),e&&s("blur",e)}function L(){f(),!t.dialogInstance&&t.pickerConfig.trapFocus&&t.picker&&(t.dialogInstance=new M.default(t.picker,document.activeElement,w.value))}function V(e="add"){const n=`${e==="add"?"set":e}Attribute`;j.forEach(a=>{t.picker.querySelector(a.selector)[n]("aria-label",a.label)})}function v(e="add"){const n=`${e}EventListener`;t.picker?.querySelectorAll(".el-date-picker__header-label").forEach(a=>{a[n]("click",f),a[n]("keydown",i=>{const l=i.keyCode||i.which;d.KEYBOARD_EVENTS.ENTER.includes(l)&&f()})})}function F(){t.picker.querySelectorAll("table").forEach(e=>{e.querySelectorAll("td").forEach(n=>{if(n.getElementsByClassName("el-date-table-cell__text")[0]?.setAttribute("role","button"),u.value){const i=n.querySelector(".el-date-table-cell__text");i.addEventListener("keydown",l=>{const K=l.keyCode||l.which;d.KEYBOARD_EVENTS.ENTER.includes(K)&&i.click()})}})})}function B(){const e=t.datePickerRef.getAttribute("aria-controls");if(t.picker=document.getElementById(e),t.picker){t.picker.setAttribute("role","dialog"),t.picker.setAttribute("aria-label","Date Picker");const n=T?.();n&&t.picker.setAttribute("data-popper-ref",`${n}-reference`),u.value?(V(),F()):v()}}function _(e){s("update:modelValue",e)}function Y(e){s("visibleChange"),e?A(!0):m(!0)}return r.onBeforeUnmount(()=>{E("remove"),t.picker&&v("remove")}),S({handleOpen:N,handleClose:P}),()=>r.h($.ElDatePicker,{ref:o,...p,modelValue:c.modelValue,"onUpdate:modelValue":_,onFocus:A,onBlur:m,onVisibleChange:Y,onPanelChange:f},{"range-separator":C["range-separator"]})}};exports.default=G;
//# sourceMappingURL=CyDatePickerHoc.cjs.map
