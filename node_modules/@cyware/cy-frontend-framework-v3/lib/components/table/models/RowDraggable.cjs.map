{"version":3,"file":"RowDraggable.cjs","sources":["../../../../src/components/table/models/RowDraggable.js"],"sourcesContent":["import Sortable from \"sortablejs\";\nimport { isNull } from \"../../../utilities/shared\";\n\nconst SORTABLE_CLASS = {\n  ghost: \"sortable-ghost\",\n  chosen: \"sortable-chosen\",\n  drag: \"sortable-drag\",\n  hover: \"hover-row\"\n};\n\nfunction toggleRowClass(element, classTypes) {\n  Object.entries(classTypes).forEach(([key, value]) => {\n    const event = value ? \"add\" : \"remove\";\n    element?.classList?.[event](SORTABLE_CLASS?.[key]);\n  });\n}\n\nclass RowDraggable {\n  lastTargetIndex = -1;\n  constructor(self) {\n    this._self = self;\n    this.initTargetElements();\n    this.init();\n  }\n  destroy() {\n    if (this.sortable) {\n      this.lastTargetIndex = -1;\n      this.sortable.destroy();\n      this.sortable = null;\n    }\n  }\n  initTargetElements() {\n    this.sortableElement = this._self.el?.querySelector(\n      \".el-table__fixed-body-wrapper tbody\"\n    );\n    const wrapperTable = this._self.el?.querySelector(\n      \".el-table__body-wrapper tbody\"\n    );\n    this.isFixed = !isNull(this.sortableElement);\n    if (!this.sortableElement) this.sortableElement = wrapperTable;\n    else this.wrapperTable = wrapperTable;\n  }\n  init() {\n    if (!this.sortableElement) return;\n    if (this.sortable) this.destroy();\n    let events = {};\n    if (this.isFixed)\n      events = {\n        onChoose: this.onChoose.bind(this),\n        onChange: this.onChange.bind(this)\n      };\n    this.sortable = Sortable.create(this.sortableElement, {\n      handle: \".cyw-row-dragger\",\n      animation: 300,\n      ghostClass: SORTABLE_CLASS.ghost,\n      chosenClass: SORTABLE_CLASS.chosen,\n      dragClass: SORTABLE_CLASS.drag,\n      delay: 0,\n      onStart: this.onStart.bind(this),\n      onEnd: this.onEnd.bind(this),\n      ...events\n    });\n  }\n  reinit() {\n    this.destroy();\n    this._self.nextTick(() => {\n      this.initTargetElements();\n      this.init();\n    });\n  }\n  onStart(event) {\n    const rowIndex = event?.oldIndex;\n    if (this.isFixed) {\n      const targetElement = this.wrapperTable?.children?.[rowIndex];\n      toggleRowClass(this.sortableElement?.children?.[rowIndex], {\n        hover: false\n      });\n      toggleRowClass(targetElement, {\n        drag: false,\n        ghost: true,\n        hover: false\n      });\n    }\n    this._self.$emits(\"rowDragStart\", { rowIndex: event?.rowIndex, event });\n  }\n  onEnd(event) {\n    const { newIndex, oldIndex } = event;\n    if (this.isFixed) {\n      const targetElement = this.wrapperTable?.children?.[newIndex];\n      toggleRowClass(this.wrapperTable?.children?.[oldIndex], {\n        hover: false\n      });\n      this._self.nextTick(() =>\n        toggleRowClass(targetElement, {\n          ghost: false,\n          chosen: false,\n          drag: false\n        })\n      );\n    }\n    const arr = this._self?.data || [];\n    const targetRow = arr.splice(oldIndex, 1)[0];\n    arr.splice(newIndex, 0, targetRow);\n\n    this.lastTargetIndex = -1;\n    this._self.$emits(\"rowDragEnd\", {\n      row: this._self.data[newIndex],\n      targetRow: targetRow,\n      data: arr,\n      newIndex,\n      oldIndex,\n      event\n    });\n  }\n  onChoose(event) {\n    const rowIndex = event?.oldIndex;\n    const targetElement = this.wrapperTable?.children?.[rowIndex];\n    toggleRowClass(this.sortableElement?.children?.[rowIndex], {\n      hover: false\n    });\n    toggleRowClass(targetElement, { chosen: true, hover: false });\n  }\n  onChange(event) {\n    const { newIndex, oldIndex } = event;\n    if (this.lastTargetIndex === newIndex) return;\n    if (this.lastTargetIndex == -1) this.lastTargetIndex = oldIndex;\n    const oldElement = this.wrapperTable?.children?.[this.lastTargetIndex];\n    const newElement = this.wrapperTable?.children?.[newIndex];\n    if (this.lastTargetIndex >= 0) {\n      toggleRowClass(this.sortableElement?.children[this.lastTargetIndex], {\n        hover: false\n      });\n      toggleRowClass(oldElement, {\n        chosen: false,\n        ghost: false,\n        hover: false\n      });\n    }\n    toggleRowClass(newElement, { ghost: true, chosen: true, hover: false });\n    this.lastTargetIndex = newIndex;\n  }\n}\n\nexport default RowDraggable;\n"],"names":["SORTABLE_CLASS","toggleRowClass","element","classTypes","key","value","event","RowDraggable","self","wrapperTable","isNull","events","Sortable","rowIndex","targetElement","newIndex","oldIndex","arr","targetRow","oldElement","newElement"],"mappings":"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"}