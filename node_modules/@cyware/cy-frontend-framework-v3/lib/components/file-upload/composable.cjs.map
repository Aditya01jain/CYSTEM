{"version":3,"file":"composable.cjs","sources":["../../../src/components/file-upload/composable.ts"],"sourcesContent":["import { type Ref } from \"vue\";\nimport { btoa } from \"../../utilities/shared\";\nimport { FileProps } from \"./types\";\nimport { fileType, getBytes } from \"../../utilities/file\";\n\nexport default function useUpload(\n  props: Ref<FileProps>,\n  events: { setFileParams: (k: string, param: any) => void }\n) {\n  const uploadFile = (event: any, _callback: Function) => {\n    const files = (event.target as HTMLInputElement).files;\n    if (!files?.length) return;\n    events.setFileParams(\"data\", files[0]);\n    const bytes = props.value.data?.size;\n    let bytesByOS;\n    if (bytes) bytesByOS = getBytes(bytes);\n    events.setFileParams(\"fileSize\", bytesByOS);\n    readFile(files[0], _callback);\n  };\n  const readFile = (file: File, _callback: Function) => {\n    const reader: FileReader = new FileReader();\n    if (props.value.config?.fileType != \"url\") {\n      reader.onload = () => {\n        events.setFileParams(\"file\", reader.result);\n        _callback();\n      };\n      reader.readAsText(file);\n      return;\n    }\n    let isError = false;\n    const isUrl = fileType(file);\n    if (isUrl) reader.readAsDataURL(file);\n    else reader.readAsText(file, \"UTF-8\");\n    reader.onload = () => {\n      const text = reader.result;\n      try {\n        let rawData = text;\n        if (!isUrl) rawData = btoa(text as string);\n        else {\n          const newStr = text?.toString().split(\",\");\n          if (newStr?.length === 2) rawData = newStr[1];\n        }\n        events.setFileParams(\"file\", rawData);\n      } catch (error) {\n        isError = true;\n      }\n      if (!isError) _callback();\n    };\n  };\n  return {\n    readFile,\n    uploadFile\n  };\n}\n"],"names":["useUpload","props","events","uploadFile","event","_callback","files","bytes","bytesByOS","getBytes","readFile","file","reader","isError","isUrl","fileType","text","rawData","btoa","newStr"],"mappings":"gMAKwB,SAAAA,EACtBC,EACAC,EACA,CACM,MAAAC,EAAa,CAACC,EAAYC,IAAwB,CAChD,MAAAC,EAASF,EAAM,OAA4B,MACjD,GAAI,CAACE,GAAO,OAAQ,OACpBJ,EAAO,cAAc,OAAQI,EAAM,CAAC,CAAC,EAC/B,MAAAC,EAAQN,EAAM,MAAM,MAAM,KAC5B,IAAAO,EACAD,IAAOC,EAAYC,EAAAA,SAASF,CAAK,GAC9BL,EAAA,cAAc,WAAYM,CAAS,EACjCE,EAAAJ,EAAM,CAAC,EAAGD,CAAS,CAAA,EAExBK,EAAW,CAACC,EAAYN,IAAwB,CAC9C,MAAAO,EAAqB,IAAI,WAC/B,GAAIX,EAAM,MAAM,QAAQ,UAAY,MAAO,CACzCW,EAAO,OAAS,IAAM,CACbV,EAAA,cAAc,OAAQU,EAAO,MAAM,EAChCP,GAAA,EAEZO,EAAO,WAAWD,CAAI,EACtB,MACF,CACA,IAAIE,EAAU,GACR,MAAAC,EAAQC,WAASJ,CAAI,EACvBG,EAAOF,EAAO,cAAcD,CAAI,EACxBC,EAAA,WAAWD,EAAM,OAAO,EACpCC,EAAO,OAAS,IAAM,CACpB,MAAMI,EAAOJ,EAAO,OAChB,GAAA,CACF,IAAIK,EAAUD,EACd,GAAI,CAACF,EAAOG,EAAUC,EAAAA,KAAKF,CAAc,MACpC,CACH,MAAMG,EAASH,GAAM,SAAS,EAAE,MAAM,GAAG,EACrCG,GAAQ,SAAW,IAAGF,EAAUE,EAAO,CAAC,EAC9C,CACOjB,EAAA,cAAc,OAAQe,CAAO,OACtB,CACJJ,EAAA,EACZ,CACKA,GAAmBR,GAAA,CAC1B,EAEK,MAAA,CACL,SAAAK,EACA,WAAAP,CAAA,CAEJ"}