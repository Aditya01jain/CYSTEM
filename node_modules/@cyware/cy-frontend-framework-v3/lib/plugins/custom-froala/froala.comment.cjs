"use strict";const l=require("froala-editor"),F="Select text to put a comment.",$="font-size: 1.4rem; padding: 2rem; max-width: 20rem; word-break: break-word";l.POPUP_TEMPLATES["comment.popup"]="[_CUSTOM_LAYER_]";l.PLUGINS.comment=function(t){const P=o=>{const e=t.fullscreen.isActive();if(o.target?.dataset?.commentid){const n=u(o.target,t,e);t.opts.callback({type:"click",spanId:o.target.dataset.commentid,position:{top:n.relativeTop,right:n.relativeRight},isFullScreen:e})}else if(o.target.parentElement?.dataset?.commentid){const n=u(o.target.parentElement,t,e);t.opts.callback({type:"click",spanId:o.target.parentElement.dataset.commentid,position:{top:n.relativeTop,right:n.relativeRight},isFullScreen:e})}};t.events.on("click",P);const R=()=>{if(window.getSelection().rangeCount>0){t.format.apply("span",{"data-commentid":"select-comment"});let n=t.$el.find('span[data-commentid="select-comment"]').last();if(n.length>0){let c=t?.html?.get()?.trim(),h=n?.html()?.trim(),a=c.replace(/<[^>]*>/g,"").trim(),s=h?.replace(/<[^>]*>/g,"")?.trim();a?.endsWith(s)&&n.after("Â "),t.undo.saveStep()}}const e=t.$el.find('[data-commentid="select-comment"]').last();if(e.length>0){const n=t.fullscreen.isActive(),c=u(e[0],t,n);t.opts.callback&&t.opts.callback({type:"add",position:{top:c.relativeTop,right:c.relativeRight},isFullScreen:n})}},u=(o,e,n)=>{if(!o||!e)return{relativeTop:0,relativeRight:0};const c=o.getBoundingClientRect(),a=e.$el?.[0]?.parentElement?.getBoundingClientRect();if(!c||!a)return{relativeTop:0,relativeRight:0};const s=parseFloat(getComputedStyle(document.documentElement).fontSize),i=4,p=40,v=c.top/s,y=c.bottom/s,g=c.height/s,m=c.right/s,b=a.top/s,f=a.height/s,S=a.right/s;if(n){const r=e.$el?.[0].parentElement?.getBoundingClientRect(),T=r.height/s,E=r.right/s,k=g>T-2*i?T-2*i:y,w=m<E-p?E-m-p:0;return{relativeTop:k,relativeRight:w}}else{const d=g>f?f:v-b+Math.max(g,i),r=m<S-p?S-m-p:0;return{relativeTop:d,relativeRight:r}}},C=()=>{const o={custom_layer:`<div style="${$}">${F}</div>`};return t.popups.create("comment.popup",o)};return{apply:R,showPopup:()=>{t.popups.get("comment.popup")||C(),t.popups.setContainer("comment.popup",t.$tb),t.popups.refresh("comment.popup");const e=t.$tb.find('.fr-command[data-cmd="comment"]'),n=e.offset().left-10,c=e.offset().top+(t.opts.toolbarBottom?10:e.outerHeight()-10);t.popups.show("comment.popup",n,c,e.outerHeight())}}};l.DefineIconTemplate("cyware-comment",'<i class="cy-flex-center cy-text-f18 cyicon-comment"></i>');l.DefineIcon("commentIcon",{NAME:"commentIcon",template:"cyware-comment"});l.RegisterCommand("comment",{title:"Comment",icon:"commentIcon",undo:!0,focus:!0,refreshAfterCallback:!0,callback:function(){!this.selection.isCollapsed()?this.comment.apply():this.comment.showPopup()}});
//# sourceMappingURL=froala.comment.cjs.map
