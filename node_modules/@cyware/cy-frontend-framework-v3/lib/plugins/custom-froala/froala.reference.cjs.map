{"version":3,"file":"froala.reference.cjs","sources":["../../../src/plugins/custom-froala/froala.reference.js"],"sourcesContent":["import FroalaEditor from \"froala-editor\";\n\nconst POPUP_STYLE =\n  \"min-width: 13.5rem; width: 25rem; word-break: break-word; max-height: 20rem;\";\n\nFroalaEditor.POPUP_TEMPLATES[\"reference.popup\"] = \"[_CUSTOM_LAYER_]\";\n\nFroalaEditor.PLUGINS.reference = function (editor) {\n  let savedRange;\n  const froalaElement = editor.$el?.[0]?.parentElement;\n\n  function addEventListeners() {\n    froalaElement.addEventListener(\"click\", saveRangeOnClickandPress);\n    froalaElement.addEventListener(\"keyup\", saveRangeOnClickandPress);\n  }\n\n  function removeEventListeners() {\n    froalaElement.removeEventListener(\"click\", saveRangeOnClickandPress);\n    froalaElement.removeEventListener(\"keyup\", saveRangeOnClickandPress);\n  }\n\n  // Attach listeners when the plugin initializes\n  addEventListeners();\n\n  function saveRangeOnClickandPress() {\n    const selection = window.getSelection();\n    if (selection.rangeCount > 0) {\n      savedRange = selection.getRangeAt(0);\n    }\n  }\n\n  const initPopup = async () => {\n    const referenceSelectOptions = await editor?.opts?.callback({\n      type: 'getReferenceList'\n    });\n    // Retrieve options from the editor's configuration (e.g., from opts)\n    const selectOptions = referenceSelectOptions || [];\n    let optionsLength = selectOptions.length;\n    let optionsHTML = optionsLength && selectOptions.map((option, idx) => {\n      const hasBorder = idx < optionsLength - 1 ? 'cyw-border-bottom-1' : '';\n      return `<div data-class=\"popup-option\" data-value=\"${option.value}\" class=\"cyw-p-2 cyw-m-2 cyw-cursor-pointer ${hasBorder}\"> ${option.label} </div>`\n    }).join('');\n    const buttonTag = `<button data-class=\"add-new-reference-btn\" data-value=\"addNewReference\" class=\"cyw-p-2 cyw-cursor-pointer cyw-color-P600 cyw-bg-N10\"> + New Reference </button>`\n    if (optionsLength) {\n      optionsHTML = optionsHTML + `<hr class=\"cyw-color-N300\"/>`;\n      optionsHTML = optionsHTML + buttonTag;\n    } else {\n      optionsHTML = buttonTag;\n    }\n    const template = {\n      custom_layer: `\n        <div style=\"${POPUP_STYLE}\" class=\"cyw-text-f12 cyw-text-medium cyw-p-3 cyw-round-lg cyw-overflow-scroll cyw-bg-N10 cyw-color-N800\">\n        <div data-class=\"popup-options\">\n          ${optionsHTML}\n        </div>\n      </div>\n      `\n    };\n\n    const popup = editor.popups.create(\"reference.popup\", template);\n\n    const selectElement = popup.find('[data-class=\"popup-options\"]')?.[0];\n\n    // Attach an event listener to the select element\n    selectElement.addEventListener('click', (event) => {\n      const value = event?.target?.getAttribute('data-value');\n      if (value) {\n        const data = selectOptions.filter((val) => val.value === value)?.[0];\n        if (data) {\n          let htmlToInsert = `<a data-id='reference-link' href='${data?.link}' target=\"_blank\">[${value}]</a>`;\n          editor.html.insert(htmlToInsert);\n        }\n        if (editor.opts.callback) {\n          editor.opts.callback({\n            type: 'select',\n            selectedValue: value\n          });\n        }\n        editor.popups.hide(\"reference.popup\");\n      }\n    });\n\n    return popup;\n  };\n\n  const addLink = (option = {}) => {\n    if (option?.value) {\n      let htmlToInsert = `<a data-id='reference-link' href='${option.link}' target=\"_blank\">[${option.value}]</a>`;\n      const selection = window.getSelection();\n      selection.removeAllRanges(); // Clear existing selection\n      selection.addRange(savedRange); // Restore saved cursor position\n      // Insert HTML at the restored cursor position\n      editor.html.insert(htmlToInsert);\n      editor.events.trigger('contentChanged');\n    }\n  }\n\n  const showPopup = async () => {\n    await initPopup();\n    editor.popups.setContainer(\"reference.popup\", editor.$tb);\n    editor.popups.refresh(\"reference.popup\");\n    const $btn = editor.$tb.find('.fr-command[data-cmd=\"reference\"]');\n    const left = $btn.offset().left - 10;\n    const top =\n      $btn.offset().top +\n      (editor.opts.toolbarBottom ? 10 : $btn.outerHeight() - 10);\n    editor.popups.show(\"reference.popup\", left, top, $btn.outerHeight());\n  };\n\n  // Remove listeners when Froala is destroyed\n  editor.events.on(\"destroy\", function () {\n    removeEventListeners();\n  });\n\n  return {\n    showPopup: showPopup,\n    addLink: addLink\n  };\n};\n\nFroalaEditor.DefineIconTemplate(\n  \"cyware-reference\",\n  '<i class=\"cy-flex-center cy-text-f18 cyicon-file-pdf\"></i>'\n);\n\nFroalaEditor.DefineIcon(\"referenceIcon\", {\n  NAME: \"referenceIcon\",\n  template: \"cyware-reference\"\n});\n\nFroalaEditor.RegisterCommand(\"reference\", {\n  title: \"Reference\",\n  icon: \"referenceIcon\",\n  undo: true,\n  focus: true,\n  refreshAfterCallback: true,\n  callback: function () {\n    this.reference.showPopup();\n  }\n});\n\n"],"names":["POPUP_STYLE","FroalaEditor","editor","savedRange","froalaElement","addEventListeners","saveRangeOnClickandPress","removeEventListeners","selection","initPopup","selectOptions","optionsLength","optionsHTML","option","idx","hasBorder","buttonTag","template","popup","event","value","data","val","htmlToInsert","addLink","showPopup","$btn","left","top"],"mappings":"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"}