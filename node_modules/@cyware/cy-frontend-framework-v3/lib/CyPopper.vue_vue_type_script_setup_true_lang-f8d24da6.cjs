"use strict";const t=require("vue"),re=require("@popperjs/core"),S=require("./utilities/constants.cjs"),q=require("./utilities/utils.cjs"),v=require("./utilities/shared.cjs"),te=require("./directives/trapfocus/index.cjs"),oe=require("./prototypes/keyHandler/index.cjs"),ne=t.defineComponent({name:"CyPopper",directives:{"cy-trapfocus":te.default},__name:"CyPopper",props:{focusOptions:{type:Object,default:()=>({})},role:{type:String,default:"dialog"},events:{default:()=>({}),type:Object},tag:{default:()=>"div",type:String},contentTag:{type:String},referenceTag:{type:String},placement:{type:String,default:"left"},boundariesSelector:{type:String,default:".cy-page"},trigger:{type:String,default:"click",validator:g=>["click","hover"].includes(g)},disabled:{type:Boolean,default:!1},content:String,reference:{},forceShow:{type:Boolean,default:!1},visibleArrow:{type:Boolean,default:!0},stopPropagation:{type:Boolean,default:!1},preventDefault:{type:Boolean,default:!1},options:{type:Object,default(){return{}}},popperClass:{type:String,default:""},hideDelay:{type:Number,default:100},openDelay:{type:Number,default:100},refClass:{type:String,default:""},virtual:{type:Boolean,default:!1},ignore:{type:Array,default:()=>[]},altPlacement:{type:String,default:""},arrowBar:{type:Boolean,default:!1},offset:{type:[Array,Number],default:()=>[5,10]},width:{type:String,default:""},parent:{type:Object,default:()=>document.body}},emits:["updated","created","force-hide","toggle","show","hide"],setup(g,{expose:M,emit:$}){const u={virtual:"data-virtual-target",action:"data-popper-action"},C=t.ref(null),A=t.ref(null),_=t.ref(null),O=t.ref(null),i=t.useAttrs(),d=$,o=g;let b=t.ref(null);const e=t.reactive({popperId:"",popper:null,referenceElm:null,popperJS:null,showPopper:!1,transition:"fade-in",arrowBarDir:"top",popperOptions:{computeStyle:{gpuAcceleration:!1},modifiers:[]},popperConf:{},observer:null,appended:{arrow:!1,popper:!1},keyHandlers:null}),l=t.computed(()=>!o.disabled&&e.showPopper),j=t.computed(()=>[C.value,e.popper,e.referenceElm,...o.ignore]),V=t.computed(()=>{let r={...i||{}},n=i?.["aria-labelledby"];return i?.["data-role"]&&(r["data-role"]=i?.["data-role"]),n?.length&&(r["aria-labelledby"]=n),r["aria-label"]=i?.["aria-label"]||"popper",i?.["data-popper"]&&(r["data-popper"]=i?.["data-popper"]),r}),T=t.computed(()=>({id:e.popperId,open:f,close:a,update:y,tabindex:l.value?0:-1,visible:l.value,arrowBarDir:e.arrowBarDir,complementDir:D}));t.provide("popperId",()=>e.popperId),t.provide("popperConf",()=>e.popperConf),e.appended={arrow:!1,popper:!1},e.popperOptions=Object.assign(e.popperOptions,o.options,{placement:o.placement}),t.onMounted(()=>{J(),I(null),y()}),t.onUnmounted(()=>{R()});function J(){let r=[{name:"offset",options:{offset:o.offset}},{name:"flip",options:{fallbackPlacements:[o.altPlacement]}},{name:"arrow",options:{padding:({placement:p,...c})=>(e.arrowBarDir=D(p?.split?.("-")?.[0]),e.popperConf={placement:p,...c},-10)}}];const n=[!0,o.altPlacement,!0];e.popperOptions={...e.popperOptions,modifiers:r.filter((p,c)=>n[c])}}function D(r){return r=r.toLowerCase(),{top:"bottom",bottom:"top",right:"left",left:"right"}[r]||"top"}function z(r){e.referenceElm!==r&&(r?.setAttribute("aria-haspopup",!0),r?.setAttribute("aria-expanded",!1))}function K(){let r=e.referenceElm?.getAttribute("id");return r?.length||(r=v.uuId(),o.virtual&&e.referenceElm?.setAttribute(u.virtual,!0),e.referenceElm.setAttribute("id",r)),r}function U(r){const n=v.isHTMLElement(r);r&&o.virtual&&n&&z(r),e.referenceElm=r||o.reference||_.value,n&&!i?.["aria-labelledby"]?.length&&A.value?.setAttribute("aria-labelledby",K()),e.popper=O.value}function F(){s("click",m),e.popper.addEventListener("mouseover",w),e.popper.addEventListener("mouseout",k),s("mouseover",w),s("mouseout",k)}function Y(){document.addEventListener("click",h),v.isHTMLElement(e.referenceElm)&&document.addEventListener("mouseup",h)}function I(r){U(r),!(!e.referenceElm||!e.popper)&&(o.trigger==="click"?B(L):(F(),s("keydown",Q)),Y())}function B(r){if(!!e.keyHandlers){for(const[p,c]of Object.entries(e.keyHandlers))s(p,c,!1);e.keyHandlers=null}else{const p=oe.default(r);e.keyHandlers=p;for(const[c,ee]of Object.entries(p))s(c,ee,!0)}}function G(r){r?.preventDefault(),r?.stopPropagation(),r?.stopImmediatePropagation(),a()}function f(){e.showPopper||(e.showPopper=!0)}function a(){e.showPopper=!1}function L(r){m(r),w()}function N(r){m(r),(!o.forceShow||o.virtual)&&(e.showPopper?a():f())}function Q(r){if(e.showPopper&&(S.isCtrlAltRight(r)||S.isCtrlAltLeft(r)))return m(r),!1;const n=r.which||r.keyCode;S.KEYBOARD_EVENTS.ENTER.includes(n)&&N(r)}function m(r){o.stopPropagation&&r.stopPropagation(),o.preventDefault&&r.preventDefault()}function E(){e.showPopper||(e.popperJS?.destroy(),e.popperJS=null,e.observer&&P(),e.appended.popper&&(e.appended.popper=!1,e.popper?.parentElement&&(o.parent||document.body).removeChild(e.popper.parentElement)))}async function y(){await e.popperJS?.update()||t.nextTick(H),d("updated")}function H(){setTimeout(()=>{o.visibleArrow&&X(e.popper),e.appended.popper||(e.appended.popper=!0,e.popper?.parentElement&&(o.parent||document.body).appendChild(e.popper.parentElement)),e.popperJS?.destroy(),o.boundariesSelector&&document.querySelector(o.boundariesSelector)&&(e.popperOptions.modifiers[4]={name:"preventOverflow",options:{enabled:!0,boundariesElement:"scrollParent",padding:10}}),e.popperOptions.onFirstUpdate=()=>{d("created",t.toRefs(e)),t.nextTick(y)},e.popperJS=re.createPopper(e.referenceElm,e.popper,e.popperOptions),W(e.referenceElm)},10)}function W(r){(r instanceof Element||r instanceof HTMLElement)&&(e.observer&&P(),e.observer=new IntersectionObserver(n=>{n[0]?.intersectionRatio<.5&&(a(),P())}),e.observer.observe(r))}function P(){e.observer.disconnect(),e.observer=null}function R(){const r=o.trigger==="hover"?m:L;[["focus",f],["blur",a],["mouseout",k],["mouseover",w]].forEach(([n,p])=>s(n,p,!1)),B(r),document.removeEventListener("click",h),document.removeEventListener("mouseup",h),e.showPopper=!1,E()}function X(r){if(e.appended.arrow)return;e.appended.arrow=!0;const n=document.createElement("div");n.setAttribute("data-popper-arrow",""),n.className="cyw-popper__arrow cyw-shadow-200",r.appendChild(n);const p=e.popperOptions.modifiers;p[3]={name:"arrow",options:{element:n}},e.popperOptions={...e.popperOptions,modifiers:p}}function x(){v.isHTMLElement(e.referenceElm)&&(e.referenceElm?.setAttribute("aria-expanded",e.showPopper),e.showPopper&&e.popperId?.length?e.referenceElm?.setAttribute("aria-controls",`${e.popperId}-wrapper`):(e.referenceElm?.removeAttribute("aria-controls"),e.referenceElm?.hasAttribute(u.virtual)&&(e.referenceElm.removeAttribute(u.virtual),e.referenceElm.removeAttribute("id"))))}function w(){clearTimeout(b),b=setTimeout(f,o.openDelay)}function k(){clearTimeout(b),b=setTimeout(a,o.hideDelay)}function h({target:r}={}){!e.showPopper||r?.getAttribute("data-ignore")||j.value.some(p=>Z(r)(p)||!q.isOutsideClick(p,r))||o.forceShow&&!o.virtual||(e.showPopper=!1)}function Z(r){return n=>n?.contains?.(r)||!1}function s(r,n,p=!0){o.virtual||e.referenceElm?.[`${p?"add":"remove"}EventListener`]?.(r,n)}return t.watch(()=>o.reference,r=>{R(),r&&(I(r),H())}),t.watch(()=>e.showPopper,r=>{const n=v.isHTMLElement(e.referenceElm);r?(d("show",r),y(),e.popperId=q.uniqueId("cy-popper-200"),n&&e.referenceElm?.setAttribute(u.action,`${e.popperId}-reference`),e.virtual&&x()):(d("hide",r),n&&e.referenceElm?.removeAttribute(u.action),o.virtual&&(d("force-hide",r),x()),e.popperId=""),d("toggle",r,{id:e.popperId})}),t.watch(()=>o.forceShow,r=>{r?f():a()},{immediate:!0}),t.watch(()=>o.disabled,r=>{r&&(e.showPopper=!1)}),M({open:f,close:a,state:e,toggle:N,destroy:E,update:y}),(r,n)=>{const p=t.resolveDirective("cy-trapfocus");return t.openBlock(),t.createElementBlock("div",{ref_key:"elRef",ref:C,class:"cyw-popper-wrapper cyw-base-font cyw-color-N900"},[t.createVNode(t.Transition,{name:e.transition,onAfterLeave:E,persisted:""},{default:t.withCtx(()=>[t.withDirectives((t.openBlock(),t.createBlock(t.resolveDynamicComponent(o.contentTag||o.tag),t.mergeProps({ref_key:"popperRef",ref:A,role:o.role,id:e.popperId,"data-popper-ref":e.popperId?`${e.popperId}-reference`:"","aria-label":t.unref(i)["aria-label"]||"popper","aria-hidden":(!l.value||e.popperId.length<0).toString(),"cy-modal-key":l.value&&e.popperId.length>0},V.value),{default:t.withCtx(()=>[t.createElementVNode("div",t.mergeProps({ref_key:"popperParent",ref:O},e.popperId.length?{id:`${e.popperId}-wrapper`}:{},{class:["cyw-popper cyw-base-font cyw-shadow-200 cyw-bg-N10 cyw-round-md cyw-border cyw-color-N900",{"cyw-popper--hidden":!l.value}]}),[t.createElementVNode("div",{class:t.normalizeClass(["cyw-popper__wrap cy-bg-N10 cyw-round-md cyw-overflow-hidden",[o.popperClass,{[`cyw-p${e.arrowBarDir[0]}-2`]:o.arrowBar}]]),style:t.normalizeStyle({width:o.width})},[l.value&&e.popperId.length>0?t.renderSlot(r.$slots,"default",t.normalizeProps(t.mergeProps({key:0},T.value)),()=>[t.createTextVNode(t.toDisplayString(o.content),1)]):t.createCommentVNode("v-if",!0)],6)],16)]),_:3},16,["role","id","data-popper-ref","aria-label","aria-hidden","cy-modal-key"])),[[t.vShow,l.value&&e.popperId.length>0],[p,{keyEvents:{esc:G,...o.events||{}},...o.focusOptions}]])]),_:3},8,["name"]),o.virtual?t.createCommentVNode("v-if",!0):(t.openBlock(),t.createBlock(t.resolveDynamicComponent(o.referenceTag||o.tag),{key:0,ref_key:"reference",ref:_,class:t.normalizeClass([o.refClass])},{default:t.withCtx(()=>[t.renderSlot(r.$slots,"reference",t.normalizeProps(t.guardReactiveProps(T.value)))]),_:3},8,["class"]))],512)}}});exports._sfc_main=ne;
//# sourceMappingURL=CyPopper.vue_vue_type_script_setup_true_lang-f8d24da6.cjs.map
