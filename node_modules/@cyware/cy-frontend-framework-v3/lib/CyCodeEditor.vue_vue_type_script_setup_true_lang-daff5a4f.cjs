"use strict";const e=require("vue"),T=require("vue-codemirror"),U=require("./CyTab.vue_vue_type_script_setup_true_lang-f63ad5d7.cjs"),N=require("./CyInput.vue_vue_type_script_setup_true_lang-432a1422.cjs"),b=require("./CyButton.vue_vue_type_script_setup_true_lang-33e4d3d7.cjs"),R=require("./CyTabPane.vue_vue_type_script_setup_true_lang-c4220bd1.cjs"),M=require("./CyDropdown.vue_vue_type_script_setup_true_lang-8460d3a0.cjs"),$=require("./components/select-option/CySelectOption.cjs"),H=require("./CyTooltip.vue_vue_type_script_setup_true_lang-f48e6aa4.cjs"),p=require("./utilities/bind-attributes.cjs"),K=require("./composables/useFullScreen.cjs"),G=require("@codemirror/theme-one-dark"),E=require("@codemirror/lang-javascript"),B=require("@codemirror/lang-python"),S=require("@codemirror/lang-json"),z=require("./components/code-editor/variables.cjs"),J={key:0,class:"cyw-round-bottom-md cyw-py-2 cyw-flex cyw-bg-N20"},Q={class:"cyw-ml-4 cyw-my-2"},W=["onDblclick"],X={class:"cyw-text-f12 cyw-tab__title cyw-text-ellipsis"},Y={class:"cyw-tab__item cyw-mr-0 cyw-flex-center selected cyw-p-0 cyw-tab__edit cyw-bg-N10 cyw-h-100"},Z={class:"cyw-tab__header-actions cyw-ml-auto cyw-flex-align-center cyw-bg-N10 cyw-pl-2"},ee={class:"cyw-code-editor__split"},te={class:"cyw-flex-text__heading"},ae={class:"cyw-flex-text__heading"},le={class:"cyw-ml-4 cyw-my-2"},oe=e.defineComponent({name:"CyCodeEditor",inheritAttrs:!1,__name:"CyCodeEditor",props:{modelValue:{},tabs:{default:()=>[]},config:{default:()=>({})},dataLabels:{default:()=>({})},disabled:{type:Boolean,default:!1}},emits:["update:modelValue","update:split","close:tab","addEdit:tab","change:tab"],setup(P,{expose:q,emit:I}){const v={javascript:E.javascriptLanguage,javascript_hints:E.javascript(),python:B.pythonLanguage,python_hints:B.python(),json:S.jsonLanguage,json_hints:S.json()},r=I,{isFullscreen:c,toggleFullscreen:x}=K.default(),n=P,l=e.reactive({selectedTab:"",editTab:-1,addTab:!1,tabName:"",position:{line:0,col:0}}),o=e.ref({}),i=e.ref({...z.DATA_LABELS,...n.dataLabels}),m=e.ref(null),f=e.ref(null),w=e.ref(n.modelValue);e.onBeforeMount(()=>{n.tabs.length&&(l.selectedTab=n.tabs[0].id)});const _=e.computed(()=>{let t=o.value?.fileType;(!t||!v.hasOwnProperty(t))&&(t="javascript"),o.value.showHints&&(t=`${t}_hints`);const a=[v[t]];return o.value.darkMode&&a.push(G.oneDark),a}),D=e.computed(()=>c.value?o.value.showSplitView&&o.value.splitView?`calc(100vh - ${o.value.splitViewOffset}rem)`:`calc(100vh - ${(o.value.childHeight||0)+12}rem)`:o.value.height),F=e.computed(()=>c.value?{parent:m.value?.$el}:{}),g=e.computed(()=>`${i.value.line}: ${l.position.line}, ${i.value.col}: ${l.position.col}`);function j(t,a){return{selected:l.selectedTab===t&&!l.addTab,"cyw-p-0 cyw-tab__edit cyw-bg-N10 cyw-h-100":l.editTab===a,"cyw-tab__item-actions":o.value.closeTab||!1}}function h(t){r("update:modelValue",t)}function A(t){r("close:tab",t),(!n.tabs[t]||n.tabs[t].id!==l.selectedTab)&&e.nextTick(()=>l.selectedTab=n.tabs[0].id)}function d(){l.editTab=-1,l.addTab=!1,l.tabName=""}function L(t){l.selectedTab=t;const a=n.tabs.findIndex(s=>t===s.id);a!==-1&&m.value?.onTabClick(a),r("change:tab",l.selectedTab)}function O({id:t}){const a=n.tabs.findIndex(s=>t===s.id);(l.editTab!==a||l.addTab)&&d(),r("change:tab",l.selectedTab)}function k(t=-1,a){if(d(),t!==-1&&a?.id){if(!o.value.editTab)return;l.editTab=t,l.selectedTab=a.id,l.tabName=a.title||""}else l.addTab=!0;e.nextTick(()=>f.value?.focus())}function C(t=-1){r("addEdit:tab",{index:t,value:l.tabName}),d(),t===-1&&e.nextTick(()=>{l.selectedTab=n.tabs[n.tabs.length-1].id})}function V(t){const a=t.state,s=a.doc.lineAt(a.selection.main.head);l.position.line=s.number,l.position.col=a.selection.ranges[0].head-s.from}return e.watch(()=>n.config,t=>o.value={...z.DEFAULT_CONFIG,...t},{immediate:!0,deep:!0}),e.watchEffect(()=>{w.value=n.modelValue}),q({isFullscreen:c,changeTab:L}),(t,a)=>n.tabs.length?(e.openBlock(),e.createBlock(U._sfc_main,e.mergeProps({key:1},{...t.$attrs,...e.unref(p.generateTestId)(t.$attrs,"code-editor")},{ref_key:"tabRef",ref:m,modelValue:l.selectedTab,"onUpdate:modelValue":a[7]||(a[7]=s=>l.selectedTab=s),class:["cyw-code-editor cyw-h-100",{"cyw-p-3 cyw-bg-N10":e.unref(c)}],data:t.tabs,type:o.value.tabType,config:{tablistClass:"cyw-overflow-x-auto cyw-overflow-y-hidden"},onClick:O}),{"tab-item":e.withCtx(({tab:s,index:u})=>[e.createElementVNode("div",{class:e.normalizeClass(["cyw-tab__item cyw-mr-0 cyw-flex-between-center",j(s.id,u)]),onDblclick:y=>k(u,s)},[l.editTab!==u?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createVNode(H._sfc_main,{content:s.title,disabled:(s.title?.length||0)<17,config:{wrapperClass:"cyw-overflow-hidden"}},{default:e.withCtx(()=>[e.createElementVNode("div",X,e.toDisplayString(s.title),1)]),_:2},1032,["content","disabled"]),o.value.closeTab?(e.openBlock(),e.createBlock(b._sfc_main,e.mergeProps({key:0},{...e.unref(p.generateTestId)(t.$attrs,`code-editor-tab-${u}-close`)},{type:"tertiary",subtype:"icon",size:"sm",class:"cyw-tab__actions cyw-ml-1","aria-label":i.value.close,disabled:n.tabs.length===1,onClick:e.withModifiers(y=>A(u),["stop"])}),{default:e.withCtx(()=>a[8]||(a[8]=[e.createElementVNode("i",{class:"cyicon-cross","aria-hidden":!0},null,-1)])),_:2},1040,["aria-label","disabled","onClick"])):e.createCommentVNode("v-if",!0)],64)):(e.openBlock(),e.createBlock(N._sfc_main,e.mergeProps({key:1,ref_key:"editInputRef",ref:f},{...e.unref(p.generateTestId)(t.$attrs,`code-editor-tab-${u}`)},{modelValue:l.tabName,"onUpdate:modelValue":a[0]||(a[0]=y=>l.tabName=y),size:"sm",class:"cyw-p-0",inputClass:"cyw-text-f12",onOnEnter:y=>C(u),onKeydown:e.withKeys(d,["esc"]),onBlur:d}),null,16,["modelValue","onOnEnter"]))],42,W)]),"header-actions":e.withCtx(()=>[o.value.editTabs?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[l.addTab?(e.openBlock(),e.createElementBlock("div",{key:1,class:e.normalizeClass(`cyw-tab--${o.value.tabType} selected`),role:"tab"},[e.createElementVNode("div",Y,[e.createVNode(N._sfc_main,{ref_key:"editInputRef",ref:f,modelValue:l.tabName,"onUpdate:modelValue":a[2]||(a[2]=s=>l.tabName=s),size:"sm",class:"cyw-p-0",inputClass:"cyw-text-f12",onOnEnter:a[3]||(a[3]=s=>C()),onKeydown:e.withKeys(d,["esc"]),onBlur:d},null,8,["modelValue"])])],2)):(e.openBlock(),e.createBlock(b._sfc_main,e.mergeProps({key:0},{...e.unref(p.generateTestId)(t.$attrs,"code-editor-add-tab")},{type:"tertiary",subtype:"icon",size:"sm",dimension:3.4,"aria-label":i.value.addTab,onClick:a[1]||(a[1]=e.withModifiers(s=>k(),["stop"]))}),{default:e.withCtx(()=>a[9]||(a[9]=[e.createElementVNode("i",{class:"cyicon-add","aria-hidden":!0},null,-1)])),_:1},16,["aria-label"]))],64)):e.createCommentVNode("v-if",!0),e.createElementVNode("div",Z,[e.renderSlot(t.$slots,"header-actions"),o.value.showSplitView?(e.openBlock(),e.createBlock(M._sfc_main,e.mergeProps({key:0},F.value,{key:e.unref(c).toString(),size:"sm"}),{"dropdown-link":e.withCtx(()=>[e.createVNode(b._sfc_main,{class:e.normalizeClass(["cyw-mr-2",{"cyw-rotate-90":!o.value.splitView}]),type:"tertiary",subtype:"icon","aria-label":i.value.switchView},{default:e.withCtx(()=>a[10]||(a[10]=[e.createElementVNode("i",{class:"cyicon-board","aria-hidden":!0},null,-1)])),_:1},8,["class","aria-label"])]),dropdown:e.withCtx(()=>[e.createElementVNode("div",ee,[e.createVNode($.default,{class:e.normalizeClass([{"cyw-select-option--selected":o.value.splitView},"cyw-border-bottom cyw-pb-2"]),onClick:a[4]||(a[4]=s=>r("update:split",!0))},{default:e.withCtx(()=>[a[11]||(a[11]=e.createElementVNode("i",{class:"cyicon-board cyw-mr-3","aria-hidden":!0},null,-1)),e.createElementVNode("span",te,e.toDisplayString(i.value.splitRight),1)]),_:1},8,["class"]),e.createVNode($.default,{class:e.normalizeClass({"cyw-select-option--selected":!o.value.splitView}),onClick:a[5]||(a[5]=s=>r("update:split",!1))},{default:e.withCtx(()=>[a[12]||(a[12]=e.createElementVNode("i",{class:"cyicon-board cyw-rotate-90 cyw-mr-3","aria-hidden":!0},null,-1)),e.createElementVNode("span",ae,e.toDisplayString(i.value.splitDown),1)]),_:1},8,["class"])])]),_:1},16)):e.createCommentVNode("v-if",!0),o.value.showFullScreen?(e.openBlock(),e.createBlock(b._sfc_main,e.mergeProps({key:1},{...e.unref(p.generateTestId)(t.$attrs,"code-editor-full-screen")},{type:"tertiary",subtype:"icon","aria-label":i.value.fullscreen,onClick:a[6]||(a[6]=s=>e.unref(x)(m.value?.$el))}),{default:e.withCtx(()=>[e.createElementVNode("i",{class:e.normalizeClass(`cyicon-fullscreen-${e.unref(c)?"off":"on"}`),"aria-hidden":!0},null,2)]),_:1},16,["aria-label"])):e.createCommentVNode("v-if",!0)])]),default:e.withCtx(()=>[e.createVNode(R._sfc_main,{name:l.selectedTab,class:"cyw-round-bottom-md",style:e.normalizeStyle({height:o.value.paneEditorHeight})},{default:e.withCtx(()=>[e.createElementVNode("div",{class:e.normalizeClass(["cyw-h-100",{"cyw-flex":o.value.splitView}])},[e.createElementVNode("div",{class:e.normalizeClass(`cyw-border-bottom cyw-h-100 cyw-w-${o.value.splitView?"50":"100"}`)},[e.renderSlot(t.$slots,"editor-header"),e.renderSlot(t.$slots,"main-editor",{},()=>[(e.openBlock(),e.createBlock(e.unref(T.Codemirror),e.mergeProps({...e.unref(p.generateTestId)(t.$attrs,"code-editor")},{class:t.$attrs.class,key:l.addTab.toString(),style:{height:D.value},modelValue:l.addTab?"":w.value,extensions:_.value,disabled:t.disabled,"tab-size":o.value.tabSize,"onUpdate:modelValue":h,onUpdate:V}),null,16,["class","style","modelValue","extensions","disabled","tab-size"]))])],2),e.renderSlot(t.$slots,"split-editor",e.normalizeProps(e.guardReactiveProps({isFullscreen:e.unref(c)})))],2),o.value.footer?(e.openBlock(),e.createElementBlock("footer",{key:0,class:e.normalizeClass(["cyw-py-2 cyw-flex cyw-bg-N20",o.value.footerClass])},[e.createElementVNode("span",le,e.toDisplayString(g.value),1),e.renderSlot(t.$slots,"footer")],2)):e.createCommentVNode("v-if",!0)]),_:3},8,["name","style"])]),_:3},16,["modelValue","data","type","class"])):(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createVNode(e.unref(T.Codemirror),e.mergeProps({...t.$attrs,...e.unref(p.generateTestId)(t.$attrs,"code-editor")},{style:{height:o.value.height},modelValue:w.value,extensions:_.value,disabled:t.disabled,"tab-size":o.value.tabSize,class:"cyw-code-editor cyw-round-bottom-md",onUpdate:V,"onUpdate:modelValue":h}),null,16,["style","modelValue","extensions","disabled","tab-size"]),o.value.footer?(e.openBlock(),e.createElementBlock("footer",J,[e.createElementVNode("span",Q,e.toDisplayString(g.value),1),e.renderSlot(t.$slots,"footer")])):e.createCommentVNode("v-if",!0)],64))}});exports._sfc_main=oe;
//# sourceMappingURL=CyCodeEditor.vue_vue_type_script_setup_true_lang-daff5a4f.cjs.map
