"use strict";const e=require("vue"),C=require("./FilterHeader.vue_vue_type_script_setup_true_lang-b8ac42a0.cjs"),F=require("./CyInput.vue_vue_type_script_setup_true_lang-432a1422.cjs"),re=require("./components/date-picker/CyDatePicker.cjs"),le=require("./CyTextarea.vue_vue_type_script_setup_true_lang-4ae317da.cjs"),$=require("./components/select/CySelect.cjs"),_=require("./CyButton.vue_vue_type_script_setup_true_lang-33e4d3d7.cjs"),oe=require("./CyPopper.vue_vue_type_script_setup_true_lang-f8d24da6.cjs"),y=require("./components/filter/variables.cjs"),p=require("radash"),d=require("./utilities/bind-attributes.cjs"),ae=["aria-label"],se={class:"cyw-px-5"},ie={class:"cyw-p-3"},ce={class:"cyw-flex-justify-end"},ue={class:"cyw-flex-align-center"},de={class:"cyw-text-f14 cyw-text-medium cyw-color-N800 cyw-flex-align-center"},pe={class:"cyw-px-5"},ye=e.defineComponent({name:"FilterList",inheritAttrs:!1,__name:"FilterList",props:{type:{default:"pro"},config:{default:()=>({})},apiService:{default:()=>({api:()=>{},apiPrefix:""})},filterList:{default:()=>[]},defaultValue:{default:null},staticFilterCount:{},timezone:{default:null}},emits:["input","apply","close:filter","add:filter","open:filter","blur","focus","reset:filter","reset:all"],setup(P,{expose:z,emit:q}){const u=e.useAttrs(),a=P,g=e.ref(null),V=e.ref({}),c=e.ref({}),x=e.ref(),n=e.reactive({filterModel:{},appliedFilters:{},activeFilters:[],currentModel:{apiOptions:{},key:""},isDatePicker:{},openPopper:!1,moreFilterSearch:""}),U=e.ref([new Date(2e3,1,1,0,0,0),new Date(2e3,1,1,23,59,59)]),i=q;e.onMounted(()=>{h()});const R=e.computed(()=>a.filterList.slice(0,a.staticFilterCount)),v=e.computed(()=>a.filterList.slice(a.staticFilterCount,a.filterList.length)),j=e.computed(()=>{let r=n.activeFilters.map(t=>t.key),l=v.value?.filter(t=>!r.includes(t.key));return n.moreFilterSearch&&(l=l.filter(t=>t.label?.toLowerCase()?.includes(n.moreFilterSearch?.toLowerCase()))),l}),S=e.computed(()=>[...R.value,...n.activeFilters]),w=r=>n.activeFilters.some(l=>l.key===r),K=e.computed(()=>{if(a.config.clearAllOnReset)return Object.values(n.appliedFilters).some(o=>o??!1);let r=!1,l={};const t=n.appliedFilters;if(Object.keys(t).forEach(o=>{([0,!1,!0].includes(t[o])||!p.isEmpty(t[o])&&t[o])&&(l[o]=t[o])}),Object.keys(l).length!==Object.keys(a.defaultValue||{}).length)return!0;if(a.defaultValue){const o=Object.keys(t);Object.keys(a.defaultValue).every(s=>o.includes(s))?Object.keys(a.defaultValue).forEach(s=>{Array.isArray(a.defaultValue)?r=!a.defaultValue.every(m=>t.includes(m)):a.defaultValue?.[s]!==t[s]&&(r=!0)}):r=!0}return r}),O=e.computed(()=>a.apiService?.getNextLink||n.currentModel.apiOptions?.link?.next||n.currentModel.apiOptions?.next),N=e.computed(()=>a.timezone||Intl.DateTimeFormat().resolvedOptions().timeZone);function h(r=a.defaultValue){if(r){n.appliedFilters=p.clone(r),n.filterModel={},n.activeFilters=[];const l=S.value.map(({key:t})=>t);Object.keys(r).forEach(t=>{const o=a.filterList.find(s=>s.type==="daterange"?s.start_key===t:s.key===t);if(o)switch(l.includes(o.key)||n.activeFilters.push(o),o.type){case"multi-select":case"select":case"dropdown":H(o,r?.[t]);break;case"daterange":o.start_key&&B(o,r?.[o.start_key]);break;case"date":B(o,r?.[t]);break;default:n.filterModel[o.key]=r?.[t]}})}}async function H(r,l){let t=r.options||[];r.api&&a.config?.fetchOptions&&(n.currentModel.apiOptions.results=await a.config.fetchOptions({filter:r,value:l}),t=JSON.parse(JSON.stringify(n.currentModel.apiOptions.results))),n.filterModel[r.key]=Array.isArray(l)?t.filter(o=>r.option_key&&l.includes(o[r.option_key])):t.find(o=>r.option_key&&o[r.option_key]===l)}function B(r,l){r.start_key&&r.end_key?(n.filterModel[r.start_key]=l,n.filterModel[r.end_key]=n.appliedFilters[r.end_key],n.filterModel[r.key]=[n.filterModel[r.start_key]*1e3,n.filterModel[r.end_key]*1e3]):n.filterModel[r.key]=l*1e3}function A(r,l){r.type==="daterange"&&r.start_key&&r.end_key?(n.filterModel[r.start_key]=n.appliedFilters[r.start_key]=l?.[0]/1e3,n.filterModel[r.end_key]=n.appliedFilters[r.end_key]=l?.[1]/1e3):n.filterModel[r.key]=n.appliedFilters[r.key]=l,l&&(n.currentModel.key=""),i("apply",n.appliedFilters)}function f(r,l){if(n.filterModel[r.key]=l,Array.isArray(l)){const t=l.map(o=>r.option_key&&o[r.option_key]);n.appliedFilters[r.key]=t.length?t:null}else typeof l=="object"&&r.option_key?n.appliedFilters[r.key]=l?.[r.option_key]:n.appliedFilters[r.key]=l;l&&(n.currentModel.key=""),i("apply",n.appliedFilters)}function b(r,l){n.filterModel[r.key]=l,n.appliedFilters[r.key]=l,l&&(n.currentModel.key=""),i("apply",n.appliedFilters)}function J(r,l){const t=a.apiService.apiPrefix||"",o=l?a.apiService?.getNextLink?.(n.currentModel.apiOptions,r)||n.currentModel.apiOptions?.link?.next:r.api;return(t+o).replace(/\/\//g,"/")}function W(r,l){return l?a.apiService?.getParams?.(n.currentModel.apiOptions,r)||{}:{...a.apiService?.getParams?.(n.currentModel.apiOptions,r,n.currentModel.search||"")||{},[a.config.searchKey]:n.currentModel.search||""}}async function X(r,l){n.currentModel.loading=!0;const t=J(r,l);try{const o=W(r,l),{data:s}=await a.apiService.api(t,{params:o}),m=s[a.config.resultKey]||s;if(l){const{results:ne}=JSON.parse(JSON.stringify(n.currentModel.apiOptions));n.currentModel.apiOptions={...s,results:[...ne,...m]}}else n.currentModel.apiOptions=Array.isArray(s)?{results:s}:{...s,results:m};O.value||(r.options=[...n.currentModel.apiOptions.results])}catch{n.currentModel.apiOptions.results=[]}n.currentModel.loading=!1}function k(r,l=!1,t=!1){if(n.currentModel.apiOptions||(n.currentModel.apiOptions={}),r.api&&(!t||t&&O.value))X(r,l);else{const o=n.currentModel.search?new RegExp(n.currentModel.search,"i"):"";n.currentModel.apiOptions.results=n.currentModel.search?r.options?.filter(s=>r.search_key?s[r.search_key]?.match(o):r.option_label&&s[r.option_label]?.match(o)||r.option_subheading&&s[r.option_subheading]?.match(o)):r.options}}const Z=p.debounce({delay:1e3},k),G=p.debounce({delay:1e3},()=>i("apply",n.appliedFilters));function E(r){n.currentModel.key!==r.key&&(i("open:filter",r),n.currentModel={apiOptions:{},key:r.key},k(r),e.nextTick(()=>{V.value[r.key]?.focus()}))}function T(r){r===n.currentModel.key&&(n.currentModel={apiOptions:{},key:""}),i("blur")}async function Q(r){n.moreFilterSearch="",n.activeFilters.push(r),setTimeout(()=>{switch(r.type){case"daterange":c.value[r.key]?.handleOpen();const l=document.querySelectorAll(".el-picker-panel .el-picker-panel__shortcut");l.length&&l[l.length-1].classList.add("cyw-base-font","cyw-button--tertiary","cyw-button--subtle","cyw-button","cyw-button--md");break;case"text":c.value[r.key]?.open();break;default:c.value[r.key]?.show();break}},100),g.value.close(),i("add:filter",r)}function M(r){n.activeFilters=n.activeFilters.filter(l=>l.key!==r.key),g.value.focus(),i("close:filter",r)}function L(r){f(r,null),i("reset:filter",r)}function D(r){n.filterModel[r.key]=null,A(r,null),i("reset:filter",r)}function Y(r){let l={};return r.avatar_key&&(l={...l,avatar:t=>r.avatar_key&&t[r.avatar_key]}),n.filterModel[r.key]?.length&&(l={...l,headerClass:"cyw-bg-P100"}),l}function ee(r,l){l?(i("open:filter",r),n.currentModel.key=r.key):(i("blur"),n.currentModel.key=""),n.isDatePicker[r.key]=l}function I(){a.config.clearAllOnReset||!a.defaultValue?(n.appliedFilters={},n.filterModel={},n.activeFilters=[]):h(),i("apply",n.appliedFilters),i("reset:all")}function te(){x.value?.focus()}return z({setDefaultValues:h,resetAll:I,focusSearchInput:te}),(r,l)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["cyw-filter-list cyw-flex-wrap cyw-flex-align-center",{"cyw-w-100":a.type==="basic"}]),role:"menubar","aria-label":e.unref(y.DATA_LABELS).filter},[!a.config.hideSearch||a.type==="basic"?(e.openBlock(),e.createBlock(F._sfc_main,e.mergeProps({key:0,ref_key:"searchInputRef",ref:x,modelValue:n.appliedFilters.q,"onUpdate:modelValue":l[0]||(l[0]=t=>n.appliedFilters.q=t)},{...e.unref(d.generateTestId)(e.unref(u),"filter-search")},{placeholder:a.config.searchPlaceholder||"Search",prefixIcon:"",prefixIconClass:"cyicon-search",iconProps:{icon:!!n.appliedFilters.q,"aria-label":e.unref(y.DATA_LABELS).clear},size:r.config.searchSize,wrapperClass:"cyw-my-0",class:["cyw-filter-list__basic-search cyw-mr-2 cyw-mb-3",r.config.searchClass],"onUpdate:modelValue":l[1]||(l[1]=t=>(i("input",t),!r.config.searchOnEnter&&e.unref(G)())),onKeypress:l[2]||(l[2]=e.withKeys(t=>r.config.searchOnEnter&&i("apply",n.appliedFilters),["enter"])),"onIcon:click":l[3]||(l[3]=t=>(n.appliedFilters.q=t,i("apply",n.appliedFilters))),onBlur:l[4]||(l[4]=t=>i("blur")),onFocus:l[5]||(l[5]=t=>i("focus"))}),{icon:e.withCtx(()=>l[10]||(l[10]=[e.createElementVNode("i",{class:"cyicon-cross-lg cyw-text-f8","aria-hidden":"true"},null,-1)])),_:1},16,["modelValue","placeholder","iconProps","size","class"])):e.createCommentVNode("v-if",!0),a.type==="pro"?(e.openBlock(),e.createElementBlock(e.Fragment,{key:1},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(S.value,t=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:t.key},[["select","multi-select","dropdown"].includes(t.type)?(e.openBlock(),e.createBlock($.default,e.mergeProps({key:0,ref_for:!0,ref:o=>c.value[t.key]=o,id:t.key,data:n.currentModel.apiOptions?.results,loading:n.currentModel.loading,"value-identifier":t.option_label,subHeadingKey:t.option_subheading,paginated:!!(n.currentModel.apiOptions?.link?.next||n.currentModel.apiOptions?.next),busy:n.currentModel.loading,identifier:t.option_key,multiple:t.type==="multi-select","model-value":n.filterModel[t.key],floatLabel:!0,iconSize:"3.2",size:"md",showButton:Array.isArray(n.filterModel[t.key])?n.filterModel[t.key].length:n.filterModel[t.key],role:"menuitem",class:"cyw-filter-list__filter-chip cyw-mb-3",wrapperClass:{"cyw-button--secondary active":!e.unref(p.isEmpty)(n.filterModel[t.key]),"cyw-button--secondary cyw-button--subtle":e.unref(p.isEmpty)(n.filterModel[t.key])},headerClass:{"cyw-button--secondary active":!e.unref(p.isEmpty)(n.filterModel[t.key]),"cyw-button--secondary cyw-button--subtle":e.unref(p.isEmpty)(n.filterModel[t.key])},config:Y(t),scrollerDistance:100},{...e.unref(d.generateTestId)(e.unref(u),`${t.key}-filter`)},{"onUpdate:modelValue":o=>f(t,o),onToggle:o=>E(t),onBlur:o=>T(t.key),onLoadMore:o=>k(t,!0)}),{header:e.withCtx(({selected:o})=>[e.createVNode(C._sfc_main,{filter:t,selected:o,isDynamicFilter:w(t.key),active:n.currentModel.key===t.key,"onClear:selection":s=>L(t),"onClose:filter":s=>{f(t,null),M(t)},onClick:s=>n.currentModel.key===t.key?c.value[t.key]?.close():c.value[t.key]?.show()},null,8,["filter","selected","isDynamicFilter","active","onClear:selection","onClose:filter","onClick"])]),"menu-header":e.withCtx(()=>[e.createElementVNode("div",se,[e.createVNode(F._sfc_main,e.mergeProps({ref_for:!0,ref:o=>V.value[t.key]=o,modelValue:n.currentModel.search,"onUpdate:modelValue":l[6]||(l[6]=o=>n.currentModel.search=o)},{...e.unref(d.generateTestId)(e.unref(u),`${t.key}-filter-search`)},{config:{showIconWhenText:!0},iconProps:{icon:"cyicon-cross",class:"cyw-text-f10"},"onIcon:click":o=>(n.currentModel.search="",k(t)),prefixIcon:"",prefixIconClass:"cyicon-search cyw-color-N700",placeholder:"Search",inputClass:"cyw-select-search",class:"cyw-filter-list__search cyw-w-100","onUpdate:modelValue":o=>e.unref(Z)(t,!1,!0)}),null,16,["modelValue","onIcon:click","onUpdate:modelValue"])])]),footer:e.withCtx(()=>[e.createVNode(_._sfc_main,e.mergeProps({type:"tertiary",subtype:"subtle",size:"md",class:"cyw-ml-3",ref_for:!0},{...e.unref(d.generateTestId)(e.unref(u),`${t.key}-filter-clear`)},{onClick:o=>f(t,null)}),{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(e.unref(y.DATA_LABELS)["clear-selection"]),1)]),_:2},1040,["onClick"])]),_:2},1040,["id","data","loading","value-identifier","subHeadingKey","paginated","busy","identifier","multiple","model-value","showButton","wrapperClass","headerClass","config","onUpdate:modelValue","onToggle","onBlur","onLoadMore"])):["text"].includes(t.type)?(e.openBlock(),e.createElementBlock("div",e.mergeProps({key:1,ref_for:!0},{...e.unref(d.generateTestId)(e.unref(u),`${t.key}-filter`)}),[e.createVNode(oe._sfc_main,{ref_for:!0,ref:o=>c.value[t.key]=o,placement:"bottom"},{reference:e.withCtx(({visible:o})=>[e.createVNode(C._sfc_main,{filter:t,selected:n.filterModel[t.key],isDynamicFilter:w(t.key),active:n.currentModel.key===t.key,class:e.normalizeClass(["cyw-p-2 cyw-round-md cyw-mt-n3 cyw-cursor-pointer cyw-filter-list__filter-chip",{"cyw-button--secondary active":n.filterModel[t.key]?.length||o,"cyw-button--secondary cyw-button--subtle":!n.filterModel[t.key]?.length&&!o}]),"onClear:selection":s=>L(t),"onClose:filter":s=>{b(t,null),M(t)},onClick:s=>n.currentModel.key===t.key?c.value[t.key]?.close():c.value[t.key]?.open()},null,8,["filter","selected","isDynamicFilter","active","class","onClear:selection","onClose:filter","onClick"])]),default:e.withCtx(()=>[e.createElementVNode("div",ie,[e.createVNode(le._sfc_main,e.mergeProps({style:{width:"30rem"},id:t.key,modelValue:n.filterModel[t.key],"onUpdate:modelValue":o=>n.filterModel[t.key]=o,floatLabel:!0,ref_for:!0},{...e.unref(d.generateTestId)(e.unref(u),`${t.key}-filter`)},{onToggle:o=>E(t),onBlur:o=>T(t.key)}),null,16,["id","modelValue","onUpdate:modelValue","onToggle","onBlur"]),l[11]||(l[11]=e.createElementVNode("hr",null,null,-1)),e.createElementVNode("div",ce,[e.createVNode(_._sfc_main,e.mergeProps({disabled:e.unref(p.isEmpty)(n.filterModel[t.key]),type:"tertiary",ref_for:!0},{...e.unref(d.generateTestId)(e.unref(u),`${t.key}-filter-clear`)},{onClick:o=>{b(t,""),c.value[t.key]?.close()}}),{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(e.unref(y.DATA_LABELS).clear),1)]),_:2},1040,["disabled","onClick"]),e.createVNode(_._sfc_main,e.mergeProps({disabled:e.unref(p.isEmpty)(n.filterModel[t.key]),ref_for:!0},{...e.unref(d.generateTestId)(e.unref(u),`${t.key}-filter-update`)},{onClick:o=>{b(t,n.filterModel[t.key]),c.value[t.key]?.close()}}),{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(e.unref(y.DATA_LABELS).update),1)]),_:2},1040,["disabled","onClick"])])])]),_:2},1536)],16)):["daterange","date"].includes(t.type)?(e.openBlock(),e.createElementBlock("div",e.mergeProps({key:2,ref_for:!0},{...e.unref(d.generateTestId)(e.unref(u),`${t.key}-filter`)}),[e.createVNode(C._sfc_main,{id:t.key,filter:t,selected:n.filterModel[t.key],isDynamicFilter:w(t.key),active:n.currentModel.key===t.key,timezone:N.value,class:e.normalizeClass(["cyw-filter-list__filter-chip cyw-cursor-pointer cyw-border-1 cyw-px-3 cyw-mb-3 cyw-round-md",{"cyw-button--secondary active":n.filterModel[t.key]?.length,"cyw-button--secondary cyw-button--subtle":!n.filterModel[t.key]?.length,focused:n.isDatePicker?.[t.key]}]),role:"menuitem","onClose:filter":o=>{D(t),M(t)},onClick:o=>n.currentModel.key===t.key?c.value[t.key]?.handleClose():c.value[t.key]?.handleOpen()},null,8,["id","filter","selected","isDynamicFilter","active","timezone","class","onClose:filter","onClick"]),e.createVNode(re.default,{ref_for:!0,ref:o=>c.value[t.key]=o,modelValue:n.filterModel[t.key],"onUpdate:modelValue":[o=>n.filterModel[t.key]=o,o=>A(t,o)],options:{type:t.type==="daterange"?"daterange":"date",valueFormat:"x","popper-class":"cyw-datepicker__popper","picker-options":{shortcuts:n.filterModel[t.key]?[{text:e.unref(y.DATA_LABELS)["clear-selection"],value:()=>D(t)}]:[]},"popper-options":{placement:"bottom-start"}},timezone:N.value,"default-time":U.value,class:"cyw-datepicker cyw-position-absolute",clearable:!1,teleported:!1,onVisibleChange:o=>ee(t,o)},null,8,["modelValue","onUpdate:modelValue","options","timezone","default-time","onVisibleChange"])],16)):e.createCommentVNode("v-if",!0)],64))),128)),e.createElementVNode("div",ue,[v.value.length?(e.openBlock(),e.createBlock($.default,e.mergeProps({ref_key:"moreFilterBtnRef",ref:g,key:"more-btn-filter","model-value":n.activeFilters,data:j.value,headerClass:"cyw-button--secondary","value-identifier":"label",identifier:"key",size:"md",class:"cyw-mt-0 cyw-mx-2 cyw-mb-3 cyw-filter-list__more-btn"},{...e.unref(d.generateTestId)(e.unref(u),"more-filters")},{"onUpdate:modelValue":Q,onBlur:l[9]||(l[9]=t=>n.moreFilterSearch="")}),e.createSlots({header:e.withCtx(()=>[e.createElementVNode("p",de,[l[12]||(l[12]=e.createElementVNode("i",{class:"cyicon-add cyw-text-f8 cyw-pr-1 cyw-mr-2","aria-hidden":"true"},null,-1)),e.createTextVNode(" "+e.toDisplayString(r.config.labels?.moreBtn),1)])]),_:2},[v.value.length>e.unref(y.MAX_FILTER_WITHOUT_SEARCH)?{name:"menu-header",fn:e.withCtx(()=>[e.createElementVNode("div",pe,[e.createVNode(F._sfc_main,e.mergeProps({modelValue:n.moreFilterSearch,"onUpdate:modelValue":l[7]||(l[7]=t=>n.moreFilterSearch=t)},{...e.unref(d.generateTestId)(e.unref(u),"dynamic-filter-search")},{config:{showIconWhenText:!0},iconProps:{icon:"cyicon-cross"},"onIcon:click":l[8]||(l[8]=t=>n.moreFilterSearch=""),prefixIcon:"",prefixIconClass:"cyicon-search cyw-color-N700",placeholder:"Search",inputClass:"cyw-select-search",class:"cyw-filter-list__search cyw-w-100"}),null,16,["modelValue"])])]),key:"0"}:void 0]),1040,["model-value","data"])):e.createCommentVNode("v-if",!0),K.value?(e.openBlock(),e.createElementBlock(e.Fragment,{key:1},[l[13]||(l[13]=e.createElementVNode("div",{class:"cyw-filter-list__seperator cyw-ml-3 cyw-mb-3","aria-hidden":"true"},null,-1)),e.createVNode(_._sfc_main,e.mergeProps({type:"tertiary",subtype:"subtle",size:"md",class:"cyw-mb-3"},{...e.unref(d.generateTestId)(e.unref(u),"filter-reset")},{onClick:I}),{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(e.unref(y.DATA_LABELS).reset),1)]),_:1},16)],64)):e.createCommentVNode("v-if",!0)])],64)):e.createCommentVNode("v-if",!0)],10,ae))}});exports._sfc_main=ye;
//# sourceMappingURL=FilterList.vue_vue_type_script_setup_true_lang-c3a48961.cjs.map
