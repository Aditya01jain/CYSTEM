"use strict";const e=require("vue"),B=require("./CyButton.vue_vue_type_script_setup_true_lang-33e4d3d7.cjs"),C=require("./FileActions.vue_vue_type_script_setup_true_lang-98bea46f.cjs"),T=require("./FileData.vue_vue_type_script_setup_true_lang-8fe2d625.cjs"),I=require("./CyHelpText.vue_vue_type_script_setup_true_lang-ddbd16f8.cjs"),q=require("./components/file-upload/composable.cjs"),i=require("./utilities/file.cjs"),b=require("./components/file-upload/variables.cjs"),z=require("./utilities/shared.cjs"),y=require("./utilities/prototypes.cjs"),c=require("./utilities/bind-attributes.cjs"),L={class:"cy-w-100 cyw-p-4 cyw-file-upload"},R=["accept"],M=["componentId","tabindex","aria-label"],O={class:"cyw-flex-center cy-p-4"},U={class:"cyw-px-4 cyw-py-3"},A={class:"cyw-flex-start-center cyw-w-100"},j={class:"cyw-flex-align-center cy-text-left cyw-w-100"},G=["id"],H={class:"cyw-flex-start-center cyw-w-100"},J={class:"cyw-text-f12 cyw-color-N600 cyw-mr-3"},K={key:1,class:"cyw-p-4 cyw-border-1 cyw-round-md cyw-flex cyw-w-100"},Q={key:0,class:"cyw-text-f10 cyw-color-R300 cyw-text-center","aria-live":"polite"},W={name:"CyFileUpload"},X=e.defineComponent({...W,name:"CyFileUpload",props:e.mergeDefaults({tabindex:{},config:{},accept:{},type:{},helpText:{},maxSize:{},value:{},label:{},disabled:{type:Boolean},uploadProgress:{},dragDrop:{type:Boolean}},b.DEFAULT_PROPS),emits:["error","upload","remove","cancel","retry"],setup(S,{expose:k,emit:N}){const l=S,n=N,o=e.ref(b.DEFAULT_CONFIG),d=z.uuId(),x={remove:_},r=e.ref({config:{},data:null,file:null,size:0,maxSize:l.maxSize});e.onMounted(()=>{o.value={...o.value,...l.config}});function h(t,a){t&&(r.value[t]=a)}const{uploadFile:E}=q.default(r,{setFileParams:h}),s=e.ref(null),v=e.computed(()=>r.value.data?l.accept&&!m()||!i.checkFileSize(r.value.maxSize,l.maxSize):!1);function P(){const t=l.value;t?.file_name||(r.value.data=y.copyObject(l.value),r.value.data={...r.value.data,name:t?.file_name,size:t?.file_size})}e.onBeforeMount(()=>{r.value.config=y.copyObject(l.config||{}),z.isNull(l.value)||P()});function f(){s.value&&(s.value.value="")}function g(){s.value.click()}const m=()=>{const t=r.value.data?.name?.split(".")||"";let a=".";return t?.length>0&&(a=`.${t[t.length-1]}`),l.accept.split(",").map(u=>u.trim()).includes(a)};function _(t){r.value.file=null,r.value.data=null,e.nextTick(()=>f()),n("remove",t)}function p(t){let a=o.value.errorMessages?.[t]||"";return t==="size"&&(a+=` ${i.formatFileSize(l.maxSize)}`),a}function D(){return i.checkFileSize(r.value.size,l.maxSize)?l.accept&&r.value.data?.name&&!m()?(n("error",{type:"invalid",message:p("invalid")}),!0):!1:(n("error",{type:"size",message:p("size")}),!0)}function w(t){E(t,()=>{D()||(o.value.noEmitter?n("upload",r.value.file,r.value.data):n("upload",t),o.value.isReset&&f())})}const V=()=>{const t=r.value.data;return{fileData:{name:i.fileName(t)||"",extension:i.fileExtension(t)||"",size:i.formatFileSize(t?.size||0)},uploadProgress:l.uploadProgress,config:o.value}};function $(t){if(!l.dragDrop)return;t.preventDefault();const a=t.dataTransfer?.files;s.value&&(s.value.files=a,w({target:{files:s.value.files}}))}function F(t,a){const u=y.getProp(o.value.actions,`${t}.trigger`);x[u]?.(a)}return k({remove:_,reset:f,triggerInput:g}),(t,a)=>(e.openBlock(),e.createElementBlock("section",L,[e.createElementVNode("input",e.mergeProps({type:"file",ref_key:"uploadRef",ref:s,class:"cyw-d-none",onChange:w,accept:l.accept},e.unref(c.generateTestId)(t.$attrs,"file-upload")),null,16,R),!r.value.file&&!r.value.data||v.value||o.value.showTrigger?(e.openBlock(),e.createElementBlock("div",e.mergeProps({key:0,componentId:e.unref(d),tabindex:l.tabindex,class:["cy-w-100 cyw-py-3 cyw-px-4 cyw-border-1 cyw-flex-between-center cyw-round-md",l.config?.contentClass],"aria-label":o.value.dataLabels.label},e.unref(c.generateTestId)(t.$attrs,"file-upload-drop"),{onDrop:$,onDragover:a[0]||(a[0]=e.withModifiers(()=>{},["prevent"]))}),[e.renderSlot(t.$slots,"content",{},()=>[e.createElementVNode("div",O,[a[3]||(a[3]=e.createElementVNode("span",{class:"cyicon-fileupload cy-mr-3 cy-mt-1 cyw-color-P600 cyw-file-icon cyw-text-bold","aria-hidden":!0},null,-1)),e.createElementVNode("div",U,[e.createElementVNode("div",A,[e.createElementVNode("div",j,[e.createElementVNode("p",{class:"cyw-text-f14",id:`label-${e.unref(d)}`},e.toDisplayString(o.value.dataLabels.label),9,G),e.createElementVNode("p",e.mergeProps({class:"cyw-text-f12 cyw-ml-3"},e.unref(c.generateTestId)(t.$attrs,"file-upload-size"))," ("+e.toDisplayString(o.value.dataLabels.size)+" < "+e.toDisplayString(e.unref(i.formatFileSize)(l.maxSize))+") ",17)])]),e.renderSlot(t.$slots,"extra-info"),e.createElementVNode("div",H,[e.createElementVNode("text",J,e.toDisplayString(o.value.dataLabels.helptext),1),t.accept?.length||t.helpText?.length?(e.openBlock(),e.createBlock(I._sfc_main,{key:0,id:`describedby-${e.unref(d)}`,disabled:l.disabled,style:{zIndex:1},"help-text":l.accept},null,8,["id","disabled","help-text"])):e.createCommentVNode("v-if",!0)])])])]),e.renderSlot(t.$slots,"trigger",{},()=>[e.createVNode(B._sfc_main,e.mergeProps({onClick:g,type:t.type||"tertiary"},e.unref(c.generateTestId)(t.$attrs,"file-upload-browse")),{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(o.value.dataLabels.browse),1)]),_:1},16,["type"])])],16,M)):(e.openBlock(),e.createElementBlock("div",K,[e.renderSlot(t.$slots,"file-info",{},()=>[e.createVNode(T._sfc_main,e.normalizeProps(e.guardReactiveProps(V())),null,16)]),e.renderSlot(t.$slots,"actions",{},()=>[e.createVNode(C._sfc_main,{class:"cyw-ml-auto",config:o.value,uploadProgress:t.uploadProgress,onTrigger:F,onRetry:a[1]||(a[1]=u=>n("retry")),onCancel:a[2]||(a[2]=u=>n("cancel"))},null,8,["config","uploadProgress"])])])),o.value.showErrors?e.createCommentVNode("v-if",!0):e.renderSlot(t.$slots,"error",{key:2,id:`error-${e.unref(d)}`},()=>[v.value?(e.openBlock(),e.createElementBlock("div",Q,[e.unref(i.checkFileSize)(r.value.data?.size,t.maxSize)?e.createCommentVNode("v-if",!0):(e.openBlock(),e.createElementBlock("span",e.normalizeProps(e.mergeProps({key:0},e.unref(c.generateTestId)(t.$attrs,"file-upload-size-error"))),e.toDisplayString(p("size")),17)),t.accept&&!m()?(e.openBlock(),e.createElementBlock("span",e.normalizeProps(e.mergeProps({key:1},e.unref(c.generateTestId)(t.$attrs,"file-upload-type-error"))),e.toDisplayString(p("invalid")),17)):e.createCommentVNode("v-if",!0)])):e.createCommentVNode("v-if",!0)])]))}});exports._sfc_main=X;
//# sourceMappingURL=CyFileUpload.vue_vue_type_script_setup_true_lang-ef4dd990.cjs.map
